<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#000000">
    <title>Mastermind Quiz - KBC Style</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Rajdhani:wght@500;700&display=swap');

        body {
            font-family: 'Rajdhani', sans-serif;
            background-color: #000;
            overflow: hidden; /* Prevent scrolling */
            touch-action: manipulation; /* Improves touch response */
            -webkit-tap-highlight-color: transparent; /* Remove blue highlight on tap */
        }

        /* KBC Background Effect */
        .studio-bg {
            background: radial-gradient(circle at center, #1a1a40 0%, #050510 70%, #000000 100%);
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
        }
        
        .light-beam {
            position: absolute;
            width: 200%;
            height: 200%;
            background: conic-gradient(from 0deg at 50% 50%, transparent 0deg, rgba(67, 56, 202, 0.1) 20deg, transparent 40deg);
            top: -50%;
            left: -50%;
            animation: rotateBeam 20s linear infinite;
            z-index: -1;
        }

        @keyframes rotateBeam {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        /* Hexagonal Buttons */
        .hex-btn {
            clip-path: polygon(5% 0, 95% 0, 100% 50%, 95% 100%, 5% 100%, 0% 50%); /* Slightly flatter hex for text fit */
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        /* Hover for desktop only - Prevents sticky hover on mobile */
        @media (hover: hover) {
            .hex-btn:hover:not(:disabled) {
                transform: scale(1.02);
                background: linear-gradient(90deg, #d97706, #fbbf24, #d97706);
                border-color: #fff;
            }
        }
        
        .hex-btn:active:not(:disabled) {
            transform: scale(0.98);
            background: linear-gradient(90deg, #d97706, #fbbf24, #d97706);
            border-color: #fff;
        }

        .option-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 0.75rem;
        }

        @media (max-width: 768px) {
            .option-container {
                grid-template-columns: 1fr;
                gap: 0.5rem;
            }
            .hex-btn {
                clip-path: polygon(3% 0, 97% 0, 100% 50%, 97% 100%, 3% 100%, 0% 50%);
            }
        }

        /* Animations */
        .pulse-gold {
            animation: pulse-gold 2s infinite;
        }

        @keyframes pulse-gold {
            0% { box-shadow: 0 0 0 0 rgba(234, 179, 8, 0.4); }
            70% { box-shadow: 0 0 0 10px rgba(234, 179, 8, 0); }
            100% { box-shadow: 0 0 0 0 rgba(234, 179, 8, 0); }
        }

        .correct-answer {
            background: linear-gradient(90deg, #065f46, #10b981, #065f46) !important;
            color: white !important;
            animation: flashGreen 0.5s 3;
        }

        .wrong-answer {
            background: linear-gradient(90deg, #7f1d1d, #ef4444, #7f1d1d) !important;
            color: white !important;
        }

        .locked-answer {
            background: linear-gradient(90deg, #92400e, #f59e0b, #92400e) !important;
            color: black !important;
            font-weight: bold;
        }

        /* Custom Scrollbar for Ladder */
        .ladder-scroll::-webkit-scrollbar {
            width: 4px;
        }
        .ladder-scroll::-webkit-scrollbar-thumb {
            background: #4f46e5; 
            border-radius: 4px;
        }

        .lifeline-used {
            opacity: 0.3;
            pointer-events: none;
            filter: grayscale(100%);
        }

        /* AI Typing Effect */
        .typing-cursor::after {
            content: '|';
            animation: blink 1s step-end infinite;
        }
        @keyframes blink { 50% { opacity: 0; } }

        /* Mobile Ladder Drawer */
        #mobile-ladder {
            transition: transform 0.3s ease-in-out;
        }
        .ladder-open {
            transform: translateX(0) !important;
        }

        /* Confetti Canvas */
        #confetti-canvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 60;
        }

        /* Input Styling */
        .neon-input:focus {
            outline: none;
            box-shadow: 0 0 20px rgba(99, 102, 241, 0.6);
            border-color: #6366f1;
        }
    </style>
</head>
<body class="text-white h-[100dvh] w-screen flex flex-col items-center justify-center select-none overflow-hidden">

    <div class="studio-bg">
        <div class="light-beam"></div>
    </div>
    
    <canvas id="confetti-canvas"></canvas>

    <!-- START SCREEN -->
    <div id="start-screen" class="z-20 text-center space-y-4 p-6 max-w-2xl w-full flex flex-col items-center justify-center h-full">
        <h1 class="text-5xl md:text-8xl font-bold text-transparent bg-clip-text bg-gradient-to-b from-yellow-300 to-yellow-600 drop-shadow-[0_0_15px_rgba(234,179,8,0.5)] mb-2 tracking-tight">
            MASTERMIND
        </h1>
        
        <!-- High Score Badge -->
        <div class="bg-indigo-900/50 px-4 py-1 rounded-full border border-indigo-500/50 mb-2">
            <span class="text-indigo-300 text-sm mr-2">TOP SCORE:</span>
            <span id="high-score-display" class="text-yellow-400 font-bold">â‚¹0</span>
        </div>

        <p class="text-lg md:text-xl text-indigo-200">15 Questions. 4 Lifelines. 1 Crore.</p>
        
        <!-- Name Input Section -->
        <div class="w-full max-w-xs space-y-2 mt-4">
            <label class="text-xs text-indigo-300 uppercase tracking-widest block text-left pl-2">Enter Your Name</label>
            <input type="text" id="player-name" placeholder="Naam toh suna hoga..." class="neon-input w-full bg-black/60 border-2 border-indigo-700 rounded-lg py-3 px-4 text-center text-white font-bold text-lg placeholder-gray-500 transition-all">
        </div>

        <div class="bg-black/60 p-4 rounded-xl border border-indigo-900/60 backdrop-blur-md w-full max-w-md shadow-2xl mt-4">
            <h3 class="text-yellow-400 font-bold mb-2 border-b border-indigo-800 pb-1 text-sm">SELECT MODE</h3>
            <div class="grid grid-cols-2 gap-2 text-left text-xs text-gray-400 mb-2">
                <div>
                    <strong class="text-indigo-300 block">CLASSIC:</strong>
                    Timer On, Harder Questions.
                </div>
                <div>
                    <strong class="text-pink-300 block">FUN MODE:</strong>
                    No Timer, All Easy Questions.
                </div>
            </div>
        </div>

        <div class="flex flex-col md:flex-row gap-4 mt-4 w-full max-w-md justify-center">
            <button onclick="startGame('classic')" class="flex-1 px-6 py-4 bg-gradient-to-r from-indigo-800 to-blue-900 rounded-xl text-lg font-bold tracking-widest active:scale-95 transition-transform shadow-[0_0_20px_rgba(79,70,229,0.3)] border border-indigo-500/50 hover:border-yellow-400">
                CLASSIC MODE
            </button>
            <button onclick="startGame('fun')" class="flex-1 px-6 py-4 bg-gradient-to-r from-purple-800 to-pink-900 rounded-xl text-lg font-bold tracking-widest active:scale-95 transition-transform shadow-[0_0_20px_rgba(236,72,153,0.3)] border border-pink-500/50 hover:border-white">
                FUN MODE ðŸŽ‰
            </button>
        </div>
        <p class="text-[10px] md:text-xs text-gray-500 mt-4">Tap to enable audio & voice</p>
    </div>

    <!-- GAME SCREEN -->
    <div id="game-screen" class="hidden z-10 w-full h-full max-w-7xl mx-auto flex flex-col md:flex-row p-2 md:p-4 gap-2 md:gap-4 relative">
        
        <!-- Mobile Ladder Drawer -->
        <div id="mobile-ladder" class="md:hidden fixed inset-y-0 right-0 w-64 bg-black/95 z-50 transform translate-x-full border-l border-indigo-500 flex flex-col pt-16 pb-4 px-2 shadow-2xl backdrop-blur-xl">
             <button onclick="toggleLadder()" class="absolute top-4 right-4 text-gray-400 hover:text-white p-2">
                <i class="fas fa-times text-2xl"></i>
            </button>
            <div class="text-center font-bold text-indigo-300 border-b border-indigo-800 pb-2 mb-2">PRIZE LADDER</div>
            <div id="mobile-money-ladder" class="flex-1 overflow-y-auto ladder-scroll flex flex-col-reverse p-2 gap-1"></div>
        </div>

        <!-- Main Game Area -->
        <div class="flex-1 flex flex-col justify-between h-full order-2 md:order-1 relative">
            
            <!-- Header Info -->
            <div class="flex justify-between items-center bg-black/40 p-3 rounded-xl border border-indigo-900/50 backdrop-blur-md shadow-lg">
                <div class="text-left pl-2">
                    <p class="text-[10px] text-indigo-400 uppercase tracking-widest font-semibold">Current Prize</p>
                    <p id="current-prize-display" class="text-2xl md:text-3xl font-bold text-yellow-400 drop-shadow-md">â‚¹0</p>
                </div>

                <!-- Mode Indicator -->
                <div id="mode-badge" class="hidden md:block px-3 py-1 rounded border text-xs font-bold tracking-widest">
                    CLASSIC
                </div>
                
                <!-- Timer -->
                <div class="w-14 h-14 md:w-16 md:h-16 rounded-full border-4 border-indigo-500 flex items-center justify-center text-lg md:text-xl font-bold shadow-[0_0_15px_rgba(99,102,241,0.5)] bg-black/50" id="timer-ring">
                    <span id="timer">30</span>
                </div>

                <!-- Mobile Ladder Toggle -->
                <button onclick="toggleLadder()" class="md:hidden w-10 h-10 flex items-center justify-center bg-indigo-900/50 rounded-full border border-indigo-500 text-indigo-300 active:scale-90 transition-transform">
                    <i class="fas fa-list-ol"></i>
                </button>
            </div>

            <!-- Question Area (Centered Vertically) -->
            <div class="flex-1 flex flex-col justify-center my-2 md:my-0">
                <!-- Lifelines -->
                <div class="flex justify-center gap-3 md:gap-4 mb-4 md:mb-8">
                    <button id="lf-5050" onclick="useLifeline('5050')" class="w-14 h-14 md:w-16 md:h-16 rounded-full bg-gradient-to-b from-blue-900 to-black border border-blue-500 flex items-center justify-center active:scale-95 transition-transform shadow-lg" title="50:50">
                        <span class="text-xs md:text-sm font-bold text-blue-300">50:50</span>
                    </button>
                    <button id="lf-poll" onclick="useLifeline('poll')" class="w-14 h-14 md:w-16 md:h-16 rounded-full bg-gradient-to-b from-blue-900 to-black border border-blue-500 flex items-center justify-center active:scale-95 transition-transform shadow-lg" title="Audience Poll">
                        <i class="fas fa-users text-blue-300 text-lg"></i>
                    </button>
                    <button id="lf-ai" onclick="useLifeline('ai')" class="w-14 h-14 md:w-16 md:h-16 rounded-full bg-gradient-to-b from-purple-900 to-black border border-purple-500 flex items-center justify-center active:scale-95 transition-transform shadow-[0_0_15px_rgba(168,85,247,0.4)]" title="Ask Cyber Sage">
                        <i class="fas fa-robot text-purple-300 text-lg"></i>
                    </button>
                </div>

                <!-- Question Box -->
                <div class="relative group mb-4 md:mb-8 mx-1">
                    <div class="absolute inset-0 bg-gradient-to-r from-transparent via-indigo-600 to-transparent opacity-30 blur-lg"></div>
                    <div class="hex-btn bg-gradient-to-b from-indigo-900 to-black border-y-2 border-indigo-400 p-6 md:p-8 text-center min-h-[100px] md:min-h-[120px] flex items-center justify-center relative z-10 shadow-2xl">
                        <h2 id="question-text" class="text-lg md:text-2xl font-bold text-white leading-tight">Question loads here...</h2>
                    </div>
                </div>

                <!-- Options Grid -->
                <div class="option-container mx-1">
                    <button onclick="selectOption(0)" id="opt-0" class="hex-btn w-full py-3 md:py-4 px-4 md:px-8 bg-gradient-to-b from-slate-900 to-black border border-indigo-500/50 text-left active:border-yellow-400 flex items-center group shadow-md min-h-[60px]">
                        <span class="text-yellow-500 font-bold mr-3 md:mr-4 text-lg md:text-xl group-hover:text-black">A:</span>
                        <span class="text-base md:text-lg text-indigo-100 group-hover:text-black font-semibold option-text leading-snug">Option 1</span>
                    </button>
                    <button onclick="selectOption(1)" id="opt-1" class="hex-btn w-full py-3 md:py-4 px-4 md:px-8 bg-gradient-to-b from-slate-900 to-black border border-indigo-500/50 text-left active:border-yellow-400 flex items-center group shadow-md min-h-[60px]">
                        <span class="text-yellow-500 font-bold mr-3 md:mr-4 text-lg md:text-xl group-hover:text-black">B:</span>
                        <span class="text-base md:text-lg text-indigo-100 group-hover:text-black font-semibold option-text leading-snug">Option 2</span>
                    </button>
                    <button onclick="selectOption(2)" id="opt-2" class="hex-btn w-full py-3 md:py-4 px-4 md:px-8 bg-gradient-to-b from-slate-900 to-black border border-indigo-500/50 text-left active:border-yellow-400 flex items-center group shadow-md min-h-[60px]">
                        <span class="text-yellow-500 font-bold mr-3 md:mr-4 text-lg md:text-xl group-hover:text-black">C:</span>
                        <span class="text-base md:text-lg text-indigo-100 group-hover:text-black font-semibold option-text leading-snug">Option 3</span>
                    </button>
                    <button onclick="selectOption(3)" id="opt-3" class="hex-btn w-full py-3 md:py-4 px-4 md:px-8 bg-gradient-to-b from-slate-900 to-black border border-indigo-500/50 text-left active:border-yellow-400 flex items-center group shadow-md min-h-[60px]">
                        <span class="text-yellow-500 font-bold mr-3 md:mr-4 text-lg md:text-xl group-hover:text-black">D:</span>
                        <span class="text-base md:text-lg text-indigo-100 group-hover:text-black font-semibold option-text leading-snug">Option 4</span>
                    </button>
                </div>
            </div>
        </div>

        <!-- Sidebar Ladder (Desktop) -->
        <div class="hidden md:flex flex-col w-64 bg-black/60 border-l border-indigo-900/50 backdrop-blur-md order-1 md:order-2 h-full rounded-l-xl overflow-hidden shadow-2xl">
            <div class="p-4 bg-indigo-900/30 text-center font-bold text-indigo-300 border-b border-indigo-800 tracking-widest">
                MONEY LADDER
            </div>
            <div id="desktop-money-ladder" class="flex-1 overflow-y-auto ladder-scroll flex flex-col-reverse p-2 gap-1">
                <!-- Generated by JS -->
            </div>
        </div>
    </div>

    <!-- MODALS -->
    
    <!-- Milestone Modal -->
    <div id="milestone-modal" class="hidden fixed inset-0 bg-black/80 z-50 flex items-center justify-center backdrop-blur-sm p-4 animate-in fade-in zoom-in duration-300">
        <div class="bg-gradient-to-b from-indigo-800 to-black p-8 rounded-2xl border-4 border-yellow-500 max-w-sm w-full text-center shadow-[0_0_50px_rgba(234,179,8,0.5)] transform scale-100">
            <h2 class="text-3xl font-bold text-yellow-300 mb-2">MILESTONE!</h2>
            <div class="text-indigo-200 mb-6">Bach Gaye Guru!</div>
            <p id="milestone-amount" class="text-5xl font-bold text-white drop-shadow-md">â‚¹10,000</p>
        </div>
    </div>

    <!-- Game Over Modal -->
    <div id="game-over-modal" class="hidden fixed inset-0 bg-black/90 z-50 flex items-center justify-center backdrop-blur-sm p-4 overflow-y-auto">
        <div class="bg-gradient-to-b from-indigo-900 to-black p-6 md:p-8 rounded-2xl border-2 border-red-500 max-w-md w-full text-center shadow-[0_0_50px_rgba(239,68,68,0.3)] my-8">
            <h2 id="end-title" class="text-3xl md:text-4xl font-bold text-white mb-2">GAME OVER</h2>
            <img id="victory-img" src="amitabh-bachchan-amitabh-bachchan-kbc.gif" class="hidden w-48 mx-auto rounded-lg mb-4 border-2 border-yellow-400 shadow-lg object-cover" alt="Victory Celebration">
            
            <p id="slang-msg" class="text-xl text-yellow-300 font-bold mb-2 italic">"Tumse na ho payega!"</p>
            <p id="end-reason" class="text-indigo-400 mb-6 text-sm">That was the wrong answer.</p>
            
            <div class="bg-black/50 p-4 rounded-lg mb-6 border border-indigo-800">
                <p class="text-xs md:text-sm text-gray-400 uppercase">You won</p>
                <p id="final-prize" class="text-3xl md:text-4xl font-bold text-yellow-400 mt-2">â‚¹0</p>
            </div>

            <!-- Share Button -->
            <button onclick="shareScore()" class="w-full py-3 bg-green-600 active:bg-green-700 text-white font-bold rounded-lg transition text-lg shadow-lg mb-3 flex items-center justify-center gap-2">
                <i class="fab fa-whatsapp text-xl"></i> Dosto Ko Jalao
            </button>

            <button onclick="document.getElementById('game-over-modal').classList.add('hidden'); document.getElementById('start-screen').classList.remove('hidden');" class="w-full py-3 bg-red-600 active:bg-red-700 text-white font-bold rounded-lg transition text-lg shadow-lg">
                BACK TO MENU
            </button>
        </div>
    </div>

    <!-- AI Lifeline Modal -->
    <div id="ai-modal" class="hidden fixed inset-0 bg-black/80 z-50 flex items-center justify-center p-4">
        <div class="bg-gray-900 w-full max-w-lg rounded-lg border border-purple-500 shadow-[0_0_30px_rgba(168,85,247,0.2)] overflow-hidden">
            <div class="bg-purple-900/50 p-3 flex justify-between items-center border-b border-purple-700">
                <div class="flex items-center gap-2">
                    <i class="fas fa-robot text-purple-300"></i>
                    <span class="font-mono text-purple-200 text-sm">CYBER_SAGE_v2.0</span>
                </div>
                <button onclick="closeModal('ai-modal')" class="text-gray-400 hover:text-white px-2 text-xl">&times;</button>
            </div>
            <div class="p-6 font-mono text-sm">
                <div class="mb-4 text-green-400 text-xs md:text-sm">
                    > Analyzing question pattern...<br>
                    > Scanning knowledge database...<br>
                    > Computing probabilities...
                </div>
                <div id="ai-response" class="text-white typing-cursor min-h-[80px] text-sm md:text-base leading-relaxed">
                    <!-- Typed by JS -->
                </div>
            </div>
            <div class="p-3 bg-gray-800 text-center">
                <button onclick="closeModal('ai-modal')" class="w-full md:w-auto px-6 py-2 bg-purple-700 active:bg-purple-600 rounded text-sm font-bold transition shadow-lg">ACKNOWLEDGE</button>
            </div>
        </div>
    </div>

    <!-- Audience Poll Modal -->
    <div id="poll-modal" class="hidden fixed inset-0 bg-black/80 z-50 flex items-center justify-center p-4">
        <div class="bg-indigo-900/95 w-full max-w-md p-6 rounded-xl border border-blue-400 shadow-[0_0_30px_rgba(59,130,246,0.3)]">
            <h3 class="text-xl md:text-2xl font-bold text-center mb-6 text-blue-200">Audience Poll Results</h3>
            <div class="flex justify-around items-end h-40 md:h-48 gap-3" id="poll-bars">
                <!-- Bars generated by JS -->
            </div>
            <button onclick="closeModal('poll-modal')" class="w-full mt-6 py-3 bg-blue-600 active:bg-blue-500 rounded font-bold shadow-lg">Close</button>
        </div>
    </div>

    <script>
        // --- GAME DATA ---
        const prizeLadder = [
            "â‚¹1,000", "â‚¹2,000", "â‚¹3,000", "â‚¹5,000", "â‚¹10,000", // Safe Haven 1
            "â‚¹20,000", "â‚¹40,000", "â‚¹80,000", "â‚¹1,60,000", "â‚¹3,20,000", // Safe Haven 2
            "â‚¹6,40,000", "â‚¹12,50,000", "â‚¹25,00,000", "â‚¹50,00,000", "â‚¹1 Crore"
        ];

        // --- QUESTION POOLS (New 150 Question Database - 50 per level - KBC Style) ---
        const easyPool = [
            { q: "Which character in the Mahabharata had the power to see distant events and narrated the war to Dhritarashtra?", o: ["Vidura", "Sanjaya", "Kripacharya", "Ashwatthama"], a: 1 },
            { q: "In the context of Indian cinema, who is known as the 'Tragedy King'?", o: ["Dilip Kumar", "Raj Kapoor", "Dev Anand", "Guru Dutt"], a: 0 },
            { q: "Which of these traditional Indian games is played on an oval court with a central divider line?", o: ["Kho-Kho", "Kabaddi", "Gilli-Danda", "Pithoo"], a: 1 },
            { q: "Which part of the plant is a potato?", o: ["Root", "Stem", "Fruit", "Leaf"], a: 1 },
            { q: "In cricket, what does 'LBW' stand for?", o: ["Leg Before Wicket", "Long Ball Wide", "Left Batsman Wicket", "Late Bowling Wide"], a: 0 },
            { q: "Which Indian state is famous for its 'Bihu' festival?", o: ["Assam", "Manipur", "Odisha", "Punjab"], a: 0 },
            { q: "According to Hindu mythology, whose vehicle is the mouse (Mooshak)?", o: ["Lord Shiva", "Lord Ganesha", "Lord Kartikeya", "Lord Vishnu"], a: 1 },
            { q: "Which gas is used in fire extinguishers to put out electrical fires?", o: ["Oxygen", "Nitrogen", "Carbon Dioxide", "Hydrogen"], a: 2 },
            { q: "The 'Golden Temple' in Amritsar is surrounded by a pool of water known as what?", o: ["Amrit Sarovar", "Pushkar Sarovar", "Mansarovar", "Narayan Sarovar"], a: 0 },
            { q: "Which film features the fictional kingdom of 'Mahishmati'?", o: ["RRR", "Baahubali", "KGF", "Padmaavat"], a: 1 },
            { q: "Which of these is NOT a classical dance form of India?", o: ["Kathak", "Bhangra", "Bharatanatyam", "Manipuri"], a: 1 },
            { q: "In the nursery rhyme 'Jack and Jill', what did they go up the hill to fetch?", o: ["A bag of gold", "A pail of water", "A basket of apples", "A lost sheep"], a: 1 },
            { q: "Which animal is the mascot for the 'Make in India' campaign?", o: ["Elephant", "Tiger", "Lion", "Leopard"], a: 2 },
            { q: "What is the Hindi term for a constellation of stars?", o: ["Nakshatra", "Graha", "Rashi", "Brahmanda"], a: 0 },
            { q: "Which of these musical instruments is a percussion instrument?", o: ["Sitar", "Tabla", "Violin", "Flute"], a: 1 },
            { q: "In the Ramayana, who was the king of the Vanaras (monkeys) before Sugriva?", o: ["Angada", "Vali", "Hanuman", "Nala"], a: 1 },
            { q: "Which Indian city is famously known as the 'City of Lakes'?", o: ["Jaipur", "Udaipur", "Jodhpur", "Bhopal"], a: 1 },
            { q: "What is the standard duration of a T20 cricket innings per team?", o: ["50 Overs", "20 Overs", "90 Minutes", "Unlimited"], a: 1 },
            { q: "Which vitamin is synthesized by the skin upon exposure to sunlight?", o: ["Vitamin A", "Vitamin C", "Vitamin D", "Vitamin K"], a: 2 },
            { q: "Who is the brother of Ravana who slept for six months at a time?", o: ["Vibhishana", "Kumbhakarna", "Meghnad", "Ahiravan"], a: 1 },
            { q: "Which of these is a popular social media platform for professionals?", o: ["Instagram", "LinkedIn", "Snapchat", "TikTok"], a: 1 },
            { q: "What is the main ingredient of the South Indian dish 'Idli'?", o: ["Wheat", "Rice and Urad Dal", "Maida", "Semolina (Rava)"], a: 1 },
            { q: "Which bird is known for laying its eggs in other birds' nests?", o: ["Crow", "Cuckoo (Koel)", "Pigeon", "Sparrow"], a: 1 },
            { q: "Who is the director of the 'Golmaal' movie series?", o: ["Priyadarshan", "Rohit Shetty", "David Dhawan", "Anees Bazmee"], a: 1 },
            { q: "Which Indian currency note features the 'Mangalyaan'?", o: ["â‚¹2000", "â‚¹500", "â‚¹200", "â‚¹100"], a: 0 },
            { q: "Which organ in the human body produces insulin?", o: ["Liver", "Pancreas", "Kidney", "Stomach"], a: 1 },
            { q: "In the game of Ludo, what is the maximum number on a standard die?", o: ["4", "6", "8", "10"], a: 1 },
            { q: "Which celestial body controls the Earth's tides?", o: ["Sun", "Moon", "Mars", "Jupiter"], a: 1 },
            { q: "Who wrote the lyrics for the song 'Jai Ho' from Slumdog Millionaire?", o: ["Javed Akhtar", "Gulzar", "Prasoon Joshi", "Irshad Kamil"], a: 1 },
            { q: "Which of these states does NOT share a border with Pakistan?", o: ["Punjab", "Rajasthan", "Gujarat", "Haryana"], a: 3 },
            { q: "What is the traditional dress of women in Kerala called?", o: ["Mekhela Chador", "Kasavu Saree", "Nauvari", "Phulkari"], a: 1 },
            { q: "Which character uses the 'Sudarshana Chakra'?", o: ["Lord Shiva", "Lord Vishnu", "Lord Brahma", "Indra"], a: 1 },
            { q: "What is the capital of the Union Territory of Ladakh?", o: ["Kargil", "Leh", "Srinagar", "Jammu"], a: 1 },
            { q: "Which sport is P.V. Sindhu associated with?", o: ["Tennis", "Badminton", "Squash", "Table Tennis"], a: 1 },
            { q: "Which gas is filled in balloons to make them float in air?", o: ["Oxygen", "Helium", "Nitrogen", "Argon"], a: 1 },
            { q: "Who played the role of 'Kapil Dev' in the movie '83'?", o: ["Ranveer Singh", "Ranbir Kapoor", "Shahid Kapoor", "Vicky Kaushal"], a: 0 },
            { q: "Which is the largest internal organ in the human body?", o: ["Heart", "Liver", "Lungs", "Kidney"], a: 1 },
            { q: "What is the Hindi name for the spice 'Cumin'?", o: ["Haldi", "Jeera", "Dhania", "Saunf"], a: 1 },
            { q: "Which Indian festival celebrates the bond between brothers and sisters?", o: ["Teej", "Raksha Bandhan", "Karva Chauth", "Bhai Dooj"], a: 1 },
            { q: "Which city hosts the headquarters of the BCCI?", o: ["Delhi", "Mumbai", "Kolkata", "Chennai"], a: 1 },
            { q: "Who is the author of 'The Jungle Book'?", o: ["Rudyard Kipling", "Ruskin Bond", "R.K. Narayan", "Enid Blyton"], a: 0 },
            { q: "Which is the nearest star to Earth?", o: ["Proxima Centauri", "Sirius", "Sun", "Alpha Centauri"], a: 2 },
            { q: "What does the 'SIM' in SIM card stand for?", o: ["Subscriber Identity Module", "Single Identity Module", "System Information Mobile", "Subscriber Internet Mobile"], a: 0 },
            { q: "Which Indian state is known as the 'Land of Five Rivers'?", o: ["Haryana", "Punjab", "Uttar Pradesh", "Bihar"], a: 1 },
            { q: "In which year did India win its second ODI Cricket World Cup?", o: ["2003", "2007", "2011", "2015"], a: 2 },
            { q: "Which fictional superhero's alter ego is Peter Parker?", o: ["Superman", "Batman", "Spider-Man", "Iron Man"], a: 2 },
            { q: "What is the freezing point of water in Fahrenheit?", o: ["0Â°F", "32Â°F", "100Â°F", "212Â°F"], a: 1 },
            { q: "Which animal appears on the logo of the World Wildlife Fund (WWF)?", o: ["Tiger", "Panda", "Lion", "Elephant"], a: 1 },
            { q: "Who is the 'Nightngale of India'?", o: ["Lata Mangeshkar", "Sarojini Naidu", "Asha Bhosle", "M.S. Subbulakshmi"], a: 1 },
            { q: "Which is the hardest natural substance on Earth?", o: ["Gold", "Iron", "Diamond", "Platinum"], a: 2 }
        ];

        const mediumPool = [
            { q: "In 1929, under whose presidency did the Indian National Congress adopt 'Purna Swaraj' as its goal?", o: ["Mahatma Gandhi", "Jawaharlal Nehru", "Subhash Chandra Bose", "Sardar Patel"], a: 1 },
            { q: "Which specific isotope of Carbon is used for carbon dating ancient fossils?", o: ["Carbon-12", "Carbon-13", "Carbon-14", "Carbon-16"], a: 2 },
            { q: "Who was the first Indian woman to win the Booker Prize?", o: ["Kiran Desai", "Arundhati Roy", "Jhumpa Lahiri", "Anita Desai"], a: 1 },
            { q: "Which city is located at the confluence of the rivers Ganga, Yamuna, and the mythical Saraswati?", o: ["Varanasi", "Haridwar", "Prayagraj", "Rishikesh"], a: 2 },
            { q: "Which Article of the Indian Constitution abolishes 'Untouchability'?", o: ["Article 16", "Article 17", "Article 18", "Article 23"], a: 1 },
            { q: "Who directed the critically acclaimed film 'Pather Panchali'?", o: ["Ritwik Ghatak", "Satyajit Ray", "Mrinal Sen", "Bimal Roy"], a: 1 },
            { q: "What is the chemical formula for 'Laughing Gas'?", o: ["NO", "NO2", "N2O", "N2O5"], a: 2 },
            { q: "Which ruler was defeated by Babur in the First Battle of Panipat in 1526?", o: ["Sikandar Lodi", "Ibrahim Lodi", "Rana Sanga", "Hemut"], a: 1 },
            { q: "In which year was the Reserve Bank of India (RBI) established?", o: ["1935", "1947", "1950", "1921"], a: 0 },
            { q: "Which planet in our solar system has the shortest day?", o: ["Earth", "Jupiter", "Mars", "Venus"], a: 1 },
            { q: "Who was the Defence Minister of India during the 1999 Kargil War?", o: ["Jaswant Singh", "George Fernandes", "Sharad Pawar", "Mulayam Singh Yadav"], a: 1 },
            { q: "Which Indian state has the highest number of seats in the Lok Sabha?", o: ["Maharashtra", "West Bengal", "Bihar", "Uttar Pradesh"], a: 3 },
            { q: "What is the name of the strait that separates the UK from France?", o: ["Palk Strait", "Dover Strait", "Bering Strait", "Strait of Gibraltar"], a: 1 },
            { q: "Who was the composer of the song 'Maa Tujhe Salaam'?", o: ["A.R. Rahman", "Ilaiyaraaja", "Vishal Bhardwaj", "Shankar-Ehsaan-Loy"], a: 0 },
            { q: "Which element is kept under kerosene to prevent it from reacting with air?", o: ["Phosphorus", "Sodium", "Magnesium", "Calcium"], a: 1 },
            { q: "Who was the only Indian Prime Minister to not face the Parliament even once?", o: ["Chaudhary Charan Singh", "V.P. Singh", "Chandra Shekhar", "H.D. Deve Gowda"], a: 0 },
            { q: "Which renowned architect designed the city of Chandigarh?", o: ["Edwin Lutyens", "Le Corbusier", "Herbert Baker", "Charles Correa"], a: 1 },
            { q: "What is the scientific study of insects called?", o: ["Etymology", "Entomology", "Ornithology", "Anthology"], a: 1 },
            { q: "In the Mahabharata, what was the real name of Bhishma?", o: ["Devavrata", "Shantanu", "Parikshit", "Pandu"], a: 0 },
            { q: "Which country gifted the 'Statue of Liberty' to the United States?", o: ["United Kingdom", "France", "Germany", "Spain"], a: 1 },
            { q: "Who was the first Indian to score a triple century in Test Cricket?", o: ["VVS Laxman", "Virender Sehwag", "Rahul Dravid", "Karun Nair"], a: 1 },
            { q: "Which acid is present in the sting of an ant?", o: ["Acetic Acid", "Formic Acid", "Citric Acid", "Lactic Acid"], a: 1 },
            { q: "The 'Jnanpith Award' is given for excellence in which field?", o: ["Sports", "Literature", "Science", "Social Service"], a: 1 },
            { q: "Which Indian state shares its border with Myanmar, China, and Bhutan?", o: ["Sikkim", "Arunachal Pradesh", "Assam", "Mizoram"], a: 1 },
            { q: "Who founded the 'Arya Samaj' in 1875?", o: ["Raja Ram Mohan Roy", "Swami Dayanand Saraswati", "Swami Vivekananda", "Ishwar Chandra Vidyasagar"], a: 1 },
            { q: "What is the full form of 'PDF' in computer terminology?", o: ["Printable Document Format", "Portable Document Format", "Public Document File", "Program Data File"], a: 1 },
            { q: "Which blood vessel carries oxygenated blood from the lungs to the heart?", o: ["Pulmonary Artery", "Pulmonary Vein", "Aorta", "Vena Cava"], a: 1 },
            { q: "Who was the Captain of the Indian Hockey Team that won the first Olympic Gold in 1928?", o: ["Dhyan Chand", "Jaipal Singh Munda", "Leslie Claudius", "Balbir Singh Sr."], a: 1 },
            { q: "Which Mughal Emperor shifted the capital from Agra to Delhi?", o: ["Akbar", "Jahangir", "Shah Jahan", "Aurangzeb"], a: 2 },
            { q: "What is the currency of Russia?", o: ["Euro", "Ruble", "Peso", "Dinar"], a: 1 },
            { q: "Which instrument is used to measure atmospheric pressure?", o: ["Thermometer", "Barometer", "Hygrometer", "Anemometer"], a: 1 },
            { q: "Who wrote the play 'Tughlaq'?", o: ["Vijay Tendulkar", "Girish Karnad", "Badal Sircar", "Mohan Rakesh"], a: 1 },
            { q: "Which Indian city is known as the 'Manchester of the South'?", o: ["Chennai", "Coimbatore", "Madurai", "Bangalore"], a: 1 },
            { q: "In which year was the 'Project Tiger' launched in India?", o: ["1971", "1973", "1980", "1985"], a: 1 },
            { q: "What is the chemical name of 'Vitamin C'?", o: ["Retinol", "Ascorbic Acid", "Calciferol", "Tocopherol"], a: 1 },
            { q: "Which mountain range separates Europe from Asia?", o: ["The Alps", "The Urals", "The Andes", "The Himalayas"], a: 1 },
            { q: "Who was the first woman Speaker of the Lok Sabha?", o: ["Meira Kumar", "Sumitra Mahajan", "Sarojini Naidu", "Najma Heptulla"], a: 0 },
            { q: "Which metal is liquid at room temperature?", o: ["Mercury", "Bromine", "Gallium", "Lead"], a: 0 },
            { q: "The 'Hornbill Festival' is celebrated in which Indian state?", o: ["Manipur", "Nagaland", "Mizoram", "Meghalaya"], a: 1 },
            { q: "Who is the author of 'Train to Pakistan'?", o: ["R.K. Narayan", "Khushwant Singh", "Mulk Raj Anand", "Vikram Seth"], a: 1 },
            { q: "Which schedule of the Indian Constitution lists the recognized languages?", o: ["Seventh Schedule", "Eighth Schedule", "Ninth Schedule", "Tenth Schedule"], a: 1 },
            { q: "Who discovered the 'X-rays'?", o: ["Marie Curie", "Wilhelm Roentgen", "Thomas Edison", "Isaac Newton"], a: 1 },
            { q: "Which ruler assumed the title of 'Gangaikonda'?", o: ["Raja Raja Chola I", "Rajendra Chola I", "Parantaka I", "Karikala"], a: 1 },
            { q: "What is the SI unit of Power?", o: ["Joule", "Watt", "Newton", "Pascal"], a: 1 },
            { q: "Who was the first Indian to win an individual medal at the Olympics?", o: ["K.D. Jadhav", "Milkha Singh", "Abhinav Bindra", "Karnam Malleswari"], a: 0 },
            { q: "Which gas leaks caused the Bhopal Gas Tragedy?", o: ["Methyl Isocyanate", "Ethyl Isocyanate", "Carbon Monoxide", "Phosgene"], a: 0 },
            { q: "Where is the headquarters of the International Court of Justice located?", o: ["Geneva", "New York", "The Hague", "Paris"], a: 2 },
            { q: "Who was the political guru of Mahatma Gandhi?", o: ["Bal Gangadhar Tilak", "Gopal Krishna Gokhale", "Dadabhai Naoroji", "Lala Lajpat Rai"], a: 1 },
            { q: "Which is the largest gland in the human body?", o: ["Pancreas", "Thyroid", "Liver", "Pituitary"], a: 2 },
            { q: "Which country is known as the 'Sugar Bowl of the World'?", o: ["Brazil", "Cuba", "India", "China"], a: 1 }
        ];

        const hardPool = [
            { q: "Who was the first Indian to be elected as a member of the British Parliament?", o: ["Dadabhai Naoroji", "Raja Ram Mohan Roy", "Gopal Krishna Gokhale", "Surendranath Banerjee"], a: 0 },
            { q: "Which treaty ended the First World War?", o: ["Treaty of Paris", "Treaty of Versailles", "Treaty of Ghent", "Treaty of Tordesillas"], a: 1 },
            { q: "What was the title of Dr. B.R. Ambedkar's doctoral thesis at the London School of Economics?", o: ["The Problem of the Rupee", "The Evolution of Provincial Finance", "The Annihilation of Caste", "Pakistan or the Partition of India"], a: 0 },
            { q: "Which European nation sold the Nicobar Islands to the British in 1868?", o: ["Portugal", "Denmark", "France", "Netherlands"], a: 1 },
            { q: "In 1923, who became the youngest President of the Indian National Congress?", o: ["Jawaharlal Nehru", "Abul Kalam Azad", "Subhash Chandra Bose", "Vallabhbhai Patel"], a: 1 },
            { q: "Which chemical element has the highest melting point?", o: ["Tungsten", "Carbon", "Platinum", "Osmium"], a: 0 }, 
            { q: "Who was the only Governor-General of India to be assassinated in office?", o: ["Lord Curzon", "Lord Mayo", "Lord Minto", "Lord Mountbatten"], a: 1 },
            { q: "Which is the only Indian state to have a uniform civil code?", o: ["Kerala", "Goa", "Mizoram", "Nagaland"], a: 1 },
            { q: "Who wrote the Sanskrit play 'Mudrarakshasa'?", o: ["Kalidasa", "Vishakhadatta", "Banabhatta", "Bhasa"], a: 1 },
            { q: "Which scientific principle explains why ships float?", o: ["Bernoulli's Principle", "Archimedes' Principle", "Pascal's Law", "Newton's Third Law"], a: 1 },
            { q: "Which king gave the title 'Raja' to Ram Mohan Roy?", o: ["Akbar II", "Bahadur Shah Zafar", "Shah Alam II", "Aurangzeb"], a: 0 },
            { q: "What is the name of the first clone of an adult mammal, a sheep?", o: ["Polly", "Dolly", "Molly", "Holly"], a: 1 },
            { q: "Which Constitutional Amendment Act reduced the voting age from 21 to 18?", o: ["42nd Amendment", "61st Amendment", "73rd Amendment", "86th Amendment"], a: 1 },
            { q: "Who was the first woman to receive the Bharat Ratna?", o: ["Mother Teresa", "Indira Gandhi", "M.S. Subbulakshmi", "Aruna Asaf Ali"], a: 1 },
            { q: "Which ancient Indian text talks about surgery and plastic surgery?", o: ["Charaka Samhita", "Sushruta Samhita", "Astanga Hridaya", "Madhava Nidana"], a: 1 },
            { q: "Which country has the most number of time zones?", o: ["Russia", "France", "USA", "China"], a: 1 }, 
            { q: "Who designed the Param Vir Chakra medal?", o: ["Savitribai Khanolkar", "Nandalal Bose", "Pingali Venkayya", "Udaya Kumar"], a: 0 },
            { q: "In the 1857 Revolt, who led the rebels in Kanpur?", o: ["Begum Hazrat Mahal", "Nana Saheb", "Kunwar Singh", "Rani Lakshmibai"], a: 1 },
            { q: "Which gas is known as 'Stranger Gas'?", o: ["Argon", "Xenon", "Neon", "Krypton"], a: 1 },
            { q: "Who was the first Indian to cross the English Channel?", o: ["Mihir Sen", "Arati Saha", "Bula Choudhury", "Shikha Tandon"], a: 0 },
            { q: "Which Article of the Constitution gives the President the power to grant pardons?", o: ["Article 72", "Article 161", "Article 61", "Article 123"], a: 0 },
            { q: "The 'Kalinga Prize' is given by which organization?", o: ["UNICEF", "UNESCO", "WHO", "WWF"], a: 1 },
            { q: "Who founded the 'Servants of India Society'?", o: ["Bal Gangadhar Tilak", "Gopal Krishna Gokhale", "Lala Lajpat Rai", "Dadabhai Naoroji"], a: 1 },
            { q: "What is the rare blood type often called 'Golden Blood'?", o: ["AB Negative", "Rh-null", "Bombay Blood Group", "O Negative"], a: 1 },
            { q: "Which battle laid the foundation of the Mughal Empire in India?", o: ["First Battle of Panipat", "Battle of Khanwa", "Second Battle of Panipat", "Battle of Ghagra"], a: 0 },
            { q: "Who was the Chairman of the Drafting Committee of the Indian Constitution?", o: ["Jawaharlal Nehru", "Dr. B.R. Ambedkar", "Dr. Rajendra Prasad", "Sardar Patel"], a: 1 },
            { q: "Which is the only continent without an active volcano?", o: ["Europe", "Australia", "Antarctica", "Africa"], a: 1 },
            { q: "Who wrote the book 'Poverty and Un-British Rule in India'?", o: ["R.C. Dutt", "Dadabhai Naoroji", "Mahatma Gandhi", "Jawaharlal Nehru"], a: 1 },
            { q: "Which Indian state has three capitals?", o: ["Maharashtra", "Andhra Pradesh", "Himachal Pradesh", "Uttarakhand"], a: 1 }, 
            { q: "Which river crosses the Equator twice?", o: ["Amazon", "Congo", "Nile", "Mississippi"], a: 1 },
            { q: "Who was the first Indian to win the 'Booker Prize'?", o: ["Salman Rushdie", "Arundhati Roy", "Kiran Desai", "Aravind Adiga"], a: 0 }, 
            { q: "What is the chemical name of 'Heavy Water'?", o: ["Hydrogen Peroxide", "Deuterium Oxide", "Tritium Oxide", "Hydrogen Oxide"], a: 1 },
            { q: "Which Viceroy partitioned Bengal in 1905?", o: ["Lord Curzon", "Lord Minto", "Lord Hardinge", "Lord Chelmsford"], a: 0 },
            { q: "The 'Moti Masjid' in Agra Fort was built by whom?", o: ["Akbar", "Shah Jahan", "Jahangir", "Aurangzeb"], a: 1 },
            { q: "Which Indian physicist founded the Indian Statistical Institute?", o: ["C.V. Raman", "P.C. Mahalanobis", "S.N. Bose", "Meghnad Saha"], a: 1 },
            { q: "What is the capital of Kazakhstan?", o: ["Almaty", "Astana", "Tashkent", "Bishkek"], a: 1 },
            { q: "Which Schedule of the Constitution contains the 'Anti-Defection Law'?", o: ["Ninth Schedule", "Tenth Schedule", "Eleventh Schedule", "Twelfth Schedule"], a: 1 },
            { q: "Who was the first person to reach the South Pole?", o: ["Robert Peary", "Roald Amundsen", "Ernest Shackleton", "Robert Scott"], a: 1 },
            { q: "Which committee recommended the establishment of the 'Panchayati Raj' system?", o: ["Ashok Mehta Committee", "Balwant Rai Mehta Committee", "Sarkaria Commission", "Mandal Commission"], a: 1 },
            { q: "Who painted 'The Last Supper'?", o: ["Michelangelo", "Leonardo da Vinci", "Raphael", "Donatello"], a: 1 },
            { q: "Which is the longest bone in the human body?", o: ["Humerus", "Femur", "Tibia", "Fibula"], a: 1 }, 
            { q: "What is the name of the first supercomputer developed in India?", o: ["Pratyush", "PARAM 8000", "Mihir", "Saga-220"], a: 1 },
            { q: "Who was the first Defence Minister of independent India?", o: ["Sardar Patel", "Baldev Singh", "V.K. Krishna Menon", "Jagjivan Ram"], a: 1 },
            { q: "Which Indian film was the first to be nominated for an Oscar?", o: ["Mother India", "Salaam Bombay", "Lagaan", "Guide"], a: 0 },
            { q: "What is the study of inscriptions called?", o: ["Numismatics", "Epigraphy", "Archaeology", "Palaeography"], a: 1 },
            { q: "Which Mughal Emperor imprisoned his father?", o: ["Humayun", "Aurangzeb", "Shah Jahan", "Jahangir"], a: 1 },
            { q: "Who was the first woman to climb Mount Everest twice?", o: ["Bachendri Pal", "Santosh Yadav", "Arunima Sinha", "Premlata Agarwal"], a: 1 },
            { q: "Which is the only Indian state to share its border with Sikkim?", o: ["Assam", "West Bengal", "Bihar", "Meghalaya"], a: 1 },
            { q: "Who coined the term 'Pakistan'?", o: ["Muhammad Ali Jinnah", "Choudhry Rahmat Ali", "Allama Iqbal", "Liaquat Ali Khan"], a: 1 },
            { q: "What is the value of the 'Chandrasekhar Limit'?", o: ["1.44 Solar Masses", "3.14 Solar Masses", "9.8 Solar Masses", "1.0 Solar Masses"], a: 0 }
        ];

        // Active questions for the current game
        let questions = [];
        let playerName = "Player";
        let bestScore = 0;
        let voices = [];
        let gameMode = 'classic'; // 'classic' or 'fun'

        function getRandomQuestions(pool, count) {
            const shuffled = [...pool].sort(() => 0.5 - Math.random());
            return shuffled.slice(0, count);
        }

        function generateGameQuestions() {
            if (gameMode === 'fun') {
                // Fun Mode: 15 questions ONLY from the Easy Pool
                questions = getRandomQuestions(easyPool, 15);
            } else {
                // Classic Mode: Standard 5-5-5 split
                questions = [
                    ...getRandomQuestions(easyPool, 5),
                    ...getRandomQuestions(mediumPool, 5),
                    ...getRandomQuestions(hardPool, 5)
                ];
            }
        }

        // --- AUDIO & VOICE ENGINE ---
        const AudioContext = window.AudioContext || window.webkitAudioContext;
        let audioCtx;
        
        // Initialize voices
        window.speechSynthesis.onvoiceschanged = () => {
            voices = window.speechSynthesis.getVoices();
        };
        
        const soundEngine = {
            init: () => {
                if (!audioCtx) audioCtx = new AudioContext();
                if (audioCtx.state === 'suspended') audioCtx.resume();
                // Prime voices
                voices = window.speechSynthesis.getVoices();
            },
            playTone: (freq, type, duration, vol = 0.1) => {
                const osc = audioCtx.createOscillator();
                const gain = audioCtx.createGain();
                osc.type = type;
                osc.frequency.setValueAtTime(freq, audioCtx.currentTime);
                gain.gain.setValueAtTime(vol, audioCtx.currentTime);
                gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + duration);
                osc.connect(gain);
                gain.connect(audioCtx.destination);
                osc.start();
                osc.stop(audioCtx.currentTime + duration);
            },
            playTick: () => {
                const osc = audioCtx.createOscillator();
                const gain = audioCtx.createGain();
                osc.type = 'triangle';
                osc.frequency.setValueAtTime(600, audioCtx.currentTime);
                gain.gain.setValueAtTime(0.05, audioCtx.currentTime);
                gain.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + 0.1);
                osc.connect(gain);
                gain.connect(audioCtx.destination);
                osc.start();
                osc.stop(audioCtx.currentTime + 0.1);
            },
            playClick: () => soundEngine.playTone(800, 'sine', 0.1, 0.05),
            playLock: () => {
                const osc1 = audioCtx.createOscillator();
                const osc2 = audioCtx.createOscillator();
                const gain = audioCtx.createGain();
                osc1.frequency.setValueAtTime(100, audioCtx.currentTime);
                osc2.frequency.setValueAtTime(103, audioCtx.currentTime);
                gain.gain.setValueAtTime(0.1, audioCtx.currentTime);
                gain.gain.linearRampToValueAtTime(0, audioCtx.currentTime + 2);
                osc1.connect(gain);
                osc2.connect(gain);
                gain.connect(audioCtx.destination);
                osc1.start(); osc2.start();
                osc1.stop(audioCtx.currentTime + 2); osc2.stop(audioCtx.currentTime + 2);
            },
            playCorrect: () => {
                soundEngine.playTone(440, 'triangle', 0.5, 0.1);
                setTimeout(() => soundEngine.playTone(554, 'triangle', 0.5, 0.1), 100);
                setTimeout(() => soundEngine.playTone(659, 'triangle', 0.8, 0.1), 200);
            },
            playWrong: () => {
                soundEngine.playTone(150, 'sawtooth', 0.8, 0.2);
                setTimeout(() => soundEngine.playTone(130, 'sawtooth', 0.8, 0.2), 200);
            },
            playLifeline: () => {
                soundEngine.playTone(1200, 'sine', 0.2, 0.1);
                setTimeout(() => soundEngine.playTone(2000, 'sine', 0.4, 0.1), 100);
            },
            playMilestone: () => {
                // Fanfare
                soundEngine.playTone(523, 'square', 0.2); // C5
                setTimeout(() => soundEngine.playTone(659, 'square', 0.2), 150); // E5
                setTimeout(() => soundEngine.playTone(783, 'square', 0.4), 300); // G5
                setTimeout(() => soundEngine.playTone(1046, 'square', 0.6), 500); // C6
            },
            speak: (text) => {
                if (!isGameActive && currentLevel === 0 && !text.includes("Game Over") && !text.includes("Crorepati")) return;
                
                window.speechSynthesis.cancel();
                const utterance = new SpeechSynthesisUtterance(text);
                
                // Try to find an Indian voice
                const indianVoice = voices.find(v => v.lang.includes('IN') || v.name.includes('India') || v.name.includes('Hindi'));
                if (indianVoice) {
                    utterance.voice = indianVoice;
                }
                
                utterance.rate = 0.9;
                utterance.pitch = 1.0;
                window.speechSynthesis.speak(utterance);
            }
        };

        // --- CONFETTI ENGINE ---
        const confettiCanvas = document.getElementById('confetti-canvas');
        const ctx = confettiCanvas.getContext('2d');
        let confettiParticles = [];
        let confettiAnimationId = null;

        function resizeCanvas() {
            confettiCanvas.width = window.innerWidth;
            confettiCanvas.height = window.innerHeight;
        }
        window.addEventListener('resize', resizeCanvas);
        resizeCanvas();

        function createConfetti(isMassive = false) {
            const count = isMassive ? 300 : 100;
            const colors = ['#f00', '#0f0', '#00f', '#ff0', '#0ff', '#f0f', '#fff', '#ffa500'];
            
            for (let i = 0; i < count; i++) {
                confettiParticles.push({
                    x: Math.random() * confettiCanvas.width,
                    y: isMassive ? Math.random() * confettiCanvas.height - confettiCanvas.height : -10,
                    w: Math.random() * 10 + 5,
                    h: Math.random() * 10 + 5,
                    color: colors[Math.floor(Math.random() * colors.length)],
                    vy: Math.random() * 5 + 2,
                    vx: Math.random() * 4 - 2,
                    spin: Math.random() * 0.2 - 0.1
                });
            }
        }

        function updateConfetti() {
            ctx.clearRect(0, 0, confettiCanvas.width, confettiCanvas.height);
            
            confettiParticles.forEach((p, i) => {
                p.y += p.vy;
                p.x += p.vx;
                p.vx += p.spin;
                
                ctx.fillStyle = p.color;
                ctx.fillRect(p.x, p.y, p.w, p.h);
                
                if (p.y > confettiCanvas.height) {
                    confettiParticles.splice(i, 1);
                }
            });

            if (confettiParticles.length > 0) {
                confettiAnimationId = requestAnimationFrame(updateConfetti);
            } else {
                cancelAnimationFrame(confettiAnimationId);
            }
        }

        function fireConfetti(duration = 2000, isMassive = false) {
            if(confettiAnimationId) cancelAnimationFrame(confettiAnimationId);
            confettiParticles = [];
            createConfetti(isMassive);
            updateConfetti();
            
            if(isMassive) {
                // Keep adding particles for a while
                let interval = setInterval(() => createConfetti(false), 200);
                setTimeout(() => clearInterval(interval), duration);
            }
        }

        // --- GAME LOGIC ---
        let currentLevel = 0;
        let isGameActive = false;
        let canAnswer = false;
        let timerInterval;
        let timeLeft = 30;
        let lifelines = { '5050': true, 'poll': true, 'ai': true };
        let isLadderOpen = false;
        
        // High Score Init
        window.onload = function() {
            const savedScore = localStorage.getItem('kbcHighScore');
            if(savedScore) {
                bestScore = parseInt(savedScore);
                document.getElementById('high-score-display').innerText = formatCurrency(bestScore);
            }
        };

        function formatCurrency(val) {
            if (val >= 10000000) return "â‚¹" + (val/10000000) + " Crore";
            if (val >= 100000) return "â‚¹" + (val/100000) + " Lakh";
            return "â‚¹" + val.toLocaleString('en-IN');
        }

        function startGame(mode) {
            const nameInput = document.getElementById('player-name').value.trim();
            if(!nameInput) {
                alert("Naam toh batao! (Enter your name)");
                return;
            }
            playerName = nameInput;
            gameMode = mode;

            soundEngine.init();
            soundEngine.playClick();
            generateGameQuestions();
            
            // Update Mode Badge
            const badge = document.getElementById('mode-badge');
            if (gameMode === 'fun') {
                badge.innerText = "FUN MODE";
                badge.className = "hidden md:block px-3 py-1 rounded border border-pink-500 text-pink-300 text-xs font-bold tracking-widest";
            } else {
                badge.innerText = "CLASSIC";
                badge.className = "hidden md:block px-3 py-1 rounded border border-indigo-500 text-indigo-300 text-xs font-bold tracking-widest";
            }
            
            document.getElementById('start-screen').classList.add('hidden');
            document.getElementById('game-screen').classList.remove('hidden');
            document.getElementById('game-screen').classList.add('flex');
            document.getElementById('game-over-modal').classList.add('hidden');
            document.getElementById('milestone-modal').classList.add('hidden');
            
            // Hide victory image on start
            document.getElementById('victory-img').classList.add('hidden');

            currentLevel = 0;
            isGameActive = true;
            lifelines = { '5050': true, 'poll': true, 'ai': true };
            
            document.querySelectorAll('.lifeline-used').forEach(el => el.classList.remove('lifeline-used'));
            buildLadder('desktop-money-ladder');
            buildLadder('mobile-money-ladder');
            loadQuestion();
        }

        function toggleLadder() {
            const ladder = document.getElementById('mobile-ladder');
            isLadderOpen = !isLadderOpen;
            if(isLadderOpen) ladder.classList.add('ladder-open');
            else ladder.classList.remove('ladder-open');
            soundEngine.playClick();
        }

        function buildLadder(elementId) {
            const container = document.getElementById(elementId);
            container.innerHTML = '';
            prizeLadder.forEach((prize, index) => {
                const div = document.createElement('div');
                div.className = `p-2 rounded flex justify-between text-xs md:text-sm ${index % 5 === 4 ? 'text-white font-bold' : 'text-orange-300'}`;
                div.id = `${elementId}-${index}`;
                div.innerHTML = `<span>${index + 1}</span> <span>${prize}</span>`;
                container.appendChild(div);
            });
        }

        function updateLadder() {
            const ids = ['desktop-money-ladder', 'mobile-money-ladder'];
            ids.forEach(baseId => {
                for(let i=0; i<prizeLadder.length; i++) {
                    const el = document.getElementById(`${baseId}-${i}`);
                    if(el) {
                        el.classList.remove('bg-orange-500', 'text-black');
                        el.classList.add(i % 5 === 4 ? 'text-white' : 'text-orange-300');
                    }
                }
                const currentEl = document.getElementById(`${baseId}-${currentLevel}`);
                if(currentEl) {
                    currentEl.classList.remove('text-orange-300', 'text-white');
                    currentEl.classList.add('bg-orange-500', 'text-black', 'font-bold');
                    currentEl.scrollIntoView({ behavior: 'smooth', block: 'center' });
                }
            });
            document.getElementById('current-prize-display').innerText = currentLevel > 0 ? prizeLadder[currentLevel - 1] : "â‚¹0";
        }

        function loadQuestion() {
            isGameActive = true;
            canAnswer = true;
            updateLadder();
            
            const qData = questions[currentLevel];
            document.getElementById('question-text').innerText = qData.q;
            
            // Voice reads the question
            soundEngine.speak(qData.q);
            
            // STRONG FIX FOR STICKY MOBILE HOVER: REPLACE BUTTONS
            for(let i=0; i<4; i++) {
                const oldBtn = document.getElementById(`opt-${i}`);
                const newBtn = oldBtn.cloneNode(true);
                oldBtn.parentNode.replaceChild(newBtn, oldBtn);
                
                // Reset styling classes completely
                newBtn.className = "hex-btn w-full py-3 md:py-4 px-4 md:px-8 bg-gradient-to-b from-slate-900 to-black border border-indigo-500/50 text-left active:border-yellow-400 flex items-center group shadow-md min-h-[60px]";
                newBtn.disabled = false;
                newBtn.classList.remove('opacity-0', 'pointer-events-none'); // Reset lifeline effects
                
                // Restore text content
                newBtn.querySelector('.option-text').innerText = qData.o[i];
                newBtn.querySelector('span:first-child').innerText = String.fromCharCode(65 + i) + ":";
                
                // Re-attach listener
                newBtn.onclick = () => selectOption(i);
            }

            // Timer Logic
            clearInterval(timerInterval);
            const timerEl = document.getElementById('timer');

            if (gameMode === 'fun') {
                // Fun Mode: No Timer
                timerEl.innerText = "âˆž";
                timeLeft = 999; // Dummy value
            } else {
                // Classic Mode: Timer Logic
                timeLeft = currentLevel < 5 ? 30 : currentLevel < 10 ? 60 : 0;
                
                if (timeLeft > 0) {
                    timerEl.innerText = timeLeft;
                    timerInterval = setInterval(() => {
                        timeLeft--;
                        timerEl.innerText = timeLeft;
                        
                        if(timeLeft > 0 && timeLeft <= 10) soundEngine.playTick(); // Play sound last 10s

                        if(timeLeft <= 0) {
                            clearInterval(timerInterval);
                            gameOver("Time's Up!");
                        }
                    }, 1000);
                } else {
                    timerEl.innerText = "âˆž";
                }
            }
        }

        function selectOption(index) {
            if (!canAnswer) return;
            canAnswer = false;
            clearInterval(timerInterval);
            soundEngine.playLock();
            window.speechSynthesis.cancel(); // Stop reading question

            const selectedBtn = document.getElementById(`opt-${index}`);
            selectedBtn.classList.add('locked-answer');

            setTimeout(() => {
                checkAnswer(index);
            }, 2000);
        }

        function checkAnswer(selectedIndex) {
            const correctIndex = questions[currentLevel].a;
            const selectedBtn = document.getElementById(`opt-${selectedIndex}`);
            const correctBtn = document.getElementById(`opt-${correctIndex}`);

            selectedBtn.classList.remove('locked-answer');

            if (selectedIndex === correctIndex) {
                // CORRECT
                selectedBtn.classList.add('correct-answer');
                soundEngine.playCorrect();
                
                setTimeout(() => {
                    // MILESTONE CHECK
                    // Logic updated for Fun Mode (still get milestones but simpler)
                    if (currentLevel === 4) { // Level 5 (10,000)
                        triggerMilestone("â‚¹10,000");
                        currentLevel++;
                    } else if (currentLevel === 9) { // Level 10 (3,20,000)
                        triggerMilestone("â‚¹3,20,000");
                        currentLevel++;
                    } else {
                        currentLevel++;
                        if (currentLevel >= questions.length) {
                            gameWon();
                        } else {
                            loadQuestion();
                        }
                    }
                }, 2000);
            } else {
                // WRONG
                selectedBtn.classList.add('wrong-answer');
                correctBtn.classList.add('correct-answer');
                soundEngine.playWrong();
                setTimeout(() => {
                    gameOver("Wrong Answer");
                }, 2000);
            }
        }

        function triggerMilestone(amount) {
            const modal = document.getElementById('milestone-modal');
            const amountEl = document.getElementById('milestone-amount');
            amountEl.innerText = amount;
            modal.classList.remove('hidden');
            soundEngine.playMilestone();
            soundEngine.speak(`Badhaai ho ${playerName}, aapne ${amount} jeet liye hain!`);
            fireConfetti(2000, true);

            setTimeout(() => {
                modal.classList.add('hidden');
                if (currentLevel >= questions.length) {
                    gameWon();
                } else {
                    loadQuestion();
                }
            }, 3000);
        }

        // --- LIFELINES (Standard Logic) ---
        function useLifeline(type) {
            if (!isGameActive || !canAnswer || !lifelines[type]) return;
            soundEngine.playLifeline();
            lifelines[type] = false;
            document.getElementById(`lf-${type}`).classList.add('lifeline-used');
            const correctIdx = questions[currentLevel].a;

            if (type === '5050') {
                let wrongIndices = [0, 1, 2, 3].filter(i => i !== correctIdx);
                wrongIndices.sort(() => Math.random() - 0.5);
                wrongIndices.slice(0, 2).forEach(idx => {
                    const btn = document.getElementById(`opt-${idx}`);
                    btn.querySelector('.option-text').innerText = "";
                    btn.classList.add('opacity-0', 'pointer-events-none');
                });
            } else if (type === 'poll') {
                showPollModal(correctIdx);
            } else if (type === 'ai') {
                showAiModal(correctIdx);
            }
        }

        function showPollModal(correctIdx) {
            const modal = document.getElementById('poll-modal');
            const container = document.getElementById('poll-bars');
            container.innerHTML = '';
            modal.classList.remove('hidden');
            let percentages = [0,0,0,0];
            percentages[correctIdx] = 40 + Math.floor(Math.random() * 30);
            let remaining = 100 - percentages[correctIdx];
            for(let i=0; i<4; i++) {
                if(i !== correctIdx) {
                    let val = Math.floor(Math.random() * (remaining / 2));
                    percentages[i] = val;
                    remaining -= val;
                }
            }
            let randomWrong = [0,1,2,3].filter(i => i!==correctIdx)[0];
            percentages[randomWrong] += remaining;
            ['A','B','C','D'].forEach((label, i) => {
                const height = percentages[i];
                const bar = document.createElement('div');
                bar.className = 'flex flex-col items-center justify-end h-full w-10 md:w-12';
                bar.innerHTML = `<div class="text-white font-bold mb-1 text-xs md:text-base">${percentages[i]}%</div><div class="w-full bg-blue-500 rounded-t transition-all duration-1000" style="height: 0%"></div><div class="text-blue-300 font-bold mt-2 text-xs md:text-base">${label}</div>`;
                container.appendChild(bar);
                setTimeout(() => { bar.children[1].style.height = `${height}%`; }, 100);
            });
        }

        function showAiModal(correctIdx) {
            const modal = document.getElementById('ai-modal');
            const textBox = document.getElementById('ai-response');
            modal.classList.remove('hidden');
            textBox.innerHTML = '';
            const options = ["Option A", "Option B", "Option C", "Option D"];
            const text = `I am ${90 + Math.floor(Math.random() * 9)}% confident the answer is ${options[correctIdx]}.`;
            let i = 0;
            const typeInterval = setInterval(() => {
                textBox.innerText += text.charAt(i);
                i++;
                if(i >= text.length) clearInterval(typeInterval);
            }, 30);
        }

        function closeModal(id) { document.getElementById(id).classList.add('hidden'); }

        // --- SLANG GENERATOR ---
        function getSlangMessage(amountValue, isWin) {
            if(isWin) return `7 Crore! ${playerName}, tu toh Devmanus nikla!`;

            if(amountValue === 0) return `Arre ${playerName} bhai, kya gunda banega re tu?`;
            if(amountValue <= 5000) return `Tumse na ho payega, ${playerName}!`;
            if(amountValue <= 80000) return `Thoda aur padhai karta ${playerName}, toh scene alag hota.`;
            if(amountValue <= 320000) return `Sahi khel gaya ${playerName}! Not bad!`;
            if(amountValue <= 5000000) return `Kadak ${playerName} bhai! Paisa hi paisa hoga!`;
            
            return `Well played ${playerName}!`;
        }

        function parseAmount(amtStr) {
            if(amtStr === "â‚¹1 Crore") return 10000000;
            return parseInt(amtStr.replace(/[â‚¹,]/g, ''));
        }

        // --- GAME END ---
        function gameOver(reason) {
            isGameActive = false;
            const modal = document.getElementById('game-over-modal');
            
            // Hide victory image on loss
            document.getElementById('victory-img').classList.add('hidden');

            document.getElementById('end-title').innerText = "KHELA KHATAM";
            document.getElementById('end-title').className = "text-3xl md:text-4xl font-bold text-white mb-2";
            document.getElementById('end-reason').innerText = reason;
            
            let winAmount = "â‚¹0";
            if (currentLevel >= 10) winAmount = "â‚¹3,20,000";
            else if (currentLevel >= 5) winAmount = "â‚¹10,000";
            document.getElementById('final-prize').innerText = winAmount;

            // Update High Score logic
            const currentVal = parseAmount(winAmount);
            if(currentVal > bestScore) {
                bestScore = currentVal;
                localStorage.setItem('kbcHighScore', bestScore);
                document.getElementById('high-score-display').innerText = winAmount;
            }

            // Set slang
            const slang = getSlangMessage(currentVal, false);
            document.getElementById('slang-msg').innerText = slang;
            
            // Voice speaks the slang
            soundEngine.speak(slang);

            modal.classList.remove('hidden');
        }

        function gameWon() {
            isGameActive = false;
            const modal = document.getElementById('game-over-modal');
            
            // Show victory image
            document.getElementById('victory-img').classList.remove('hidden');
            
            document.getElementById('end-title').innerText = "ADBHUT!";
            document.getElementById('end-title').className = "text-5xl md:text-6xl font-bold text-transparent bg-clip-text bg-gradient-to-b from-yellow-300 to-yellow-600 mb-2";
            document.getElementById('end-reason').innerText = "Saare sawaal sahi!";
            document.getElementById('final-prize').innerText = "â‚¹1 Crore";
            
            // Update High Score
            const currentVal = 10000000;
            if(currentVal > bestScore) {
                bestScore = currentVal;
                localStorage.setItem('kbcHighScore', bestScore);
                document.getElementById('high-score-display').innerText = "â‚¹1 Crore";
            }

            // Set slang
            const slang = getSlangMessage(currentVal, true);
            document.getElementById('slang-msg').innerText = slang;
            
            // Voice speaks the slang
            soundEngine.speak(slang);

            modal.classList.remove('hidden');
            soundEngine.playMilestone();
            fireConfetti(5000, true);
        }

        function restartGame() { 
            // Reset to start screen to ask for name again or just start? 
            // Let's just restart keeping the name
            // Wait, restart logic needs to direct back to menu or restart last mode?
            // Actually, game over screen has "Back to Menu" now.
            // But if called directly:
            startGame(gameMode); 
        }

        // --- SOCIAL SHARE ---
        async function shareScore() {
            const prize = document.getElementById('final-prize').innerText;
            const text = `ðŸ”¥ Maine Mastermind KBC (${gameMode === 'fun' ? 'Fun Mode' : 'Classic'}) mein ${prize} jeeta! \n\n${playerName}: "${document.getElementById('slang-msg').innerText}"\n\nHai dum toh beat kar ke dikha! ðŸ’ªðŸ˜Ž`;
            
            if (navigator.share) {
                try {
                    await navigator.share({
                        title: 'Mastermind Quiz Score',
                        text: text,
                        url: window.location.href
                    });
                } catch (err) {
                    console.log('Share failed:', err);
                }
            } else {
                // Fallback for desktop
                try {
                    await navigator.clipboard.writeText(text);
                    alert("Score copied to clipboard! Paste it in WhatsApp.");
                } catch (err) {
                    alert("Sharing not supported on this device.");
                }
            }
        }

    </script>
</body>
</html>
