<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#000000">
    <title>Mastermind Quiz - KBC Style</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Rajdhani:wght@500;700&display=swap');

        body {
            font-family: 'Rajdhani', sans-serif;
            background-color: #000;
            overflow: hidden; /* Prevent scrolling */
            touch-action: manipulation; /* Improves touch response */
            -webkit-tap-highlight-color: transparent; /* Remove blue highlight on tap */
        }

        /* KBC Background Effect */
        .studio-bg {
            background: radial-gradient(circle at center, #1a1a40 0%, #050510 70%, #000000 100%);
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
        }
        
        .light-beam {
            position: absolute;
            width: 200%;
            height: 200%;
            background: conic-gradient(from 0deg at 50% 50%, transparent 0deg, rgba(67, 56, 202, 0.1) 20deg, transparent 40deg);
            top: -50%;
            left: -50%;
            animation: rotateBeam 20s linear infinite;
            z-index: -1;
        }

        @keyframes rotateBeam {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        /* Hexagonal Buttons */
        .hex-btn {
            clip-path: polygon(5% 0, 95% 0, 100% 50%, 95% 100%, 5% 100%, 0% 50%); /* Slightly flatter hex for text fit */
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        /* Hover for desktop only - Prevents sticky hover on mobile */
        @media (hover: hover) {
            .hex-btn:hover:not(:disabled) {
                transform: scale(1.02);
                background: linear-gradient(90deg, #d97706, #fbbf24, #d97706);
                border-color: #fff;
            }
        }
        
        .hex-btn:active:not(:disabled) {
            transform: scale(0.98);
            background: linear-gradient(90deg, #d97706, #fbbf24, #d97706);
            border-color: #fff;
        }

        .option-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 0.75rem;
        }

        @media (max-width: 768px) {
            .option-container {
                grid-template-columns: 1fr;
                gap: 0.5rem;
            }
            .hex-btn {
                clip-path: polygon(3% 0, 97% 0, 100% 50%, 97% 100%, 3% 100%, 0% 50%);
            }
        }

        /* Animations */
        .pulse-gold {
            animation: pulse-gold 2s infinite;
        }

        @keyframes pulse-gold {
            0% { box-shadow: 0 0 0 0 rgba(234, 179, 8, 0.4); }
            70% { box-shadow: 0 0 0 10px rgba(234, 179, 8, 0); }
            100% { box-shadow: 0 0 0 0 rgba(234, 179, 8, 0); }
        }

        .correct-answer {
            background: linear-gradient(90deg, #065f46, #10b981, #065f46) !important;
            color: white !important;
            animation: flashGreen 0.5s 3;
        }

        .wrong-answer {
            background: linear-gradient(90deg, #7f1d1d, #ef4444, #7f1d1d) !important;
            color: white !important;
        }

        .locked-answer {
            background: linear-gradient(90deg, #92400e, #f59e0b, #92400e) !important;
            color: black !important;
            font-weight: bold;
        }

        /* Custom Scrollbar for Ladder */
        .ladder-scroll::-webkit-scrollbar {
            width: 4px;
        }
        .ladder-scroll::-webkit-scrollbar-thumb {
            background: #4f46e5; 
            border-radius: 4px;
        }

        .lifeline-used {
            opacity: 0.3;
            pointer-events: none;
            filter: grayscale(100%);
        }

        /* AI Typing Effect */
        .typing-cursor::after {
            content: '|';
            animation: blink 1s step-end infinite;
        }
        @keyframes blink { 50% { opacity: 0; } }

        /* Mobile Ladder Drawer */
        #mobile-ladder {
            transition: transform 0.3s ease-in-out;
        }
        .ladder-open {
            transform: translateX(0) !important;
        }

        /* Confetti Canvas */
        #confetti-canvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 60;
        }

        /* Input Styling */
        .neon-input:focus {
            outline: none;
            box-shadow: 0 0 20px rgba(99, 102, 241, 0.6);
            border-color: #6366f1;
        }
    </style>
</head>
<body class="text-white h-[100dvh] w-screen flex flex-col items-center justify-center select-none overflow-hidden">

    <div class="studio-bg">
        <div class="light-beam"></div>
    </div>
    
    <canvas id="confetti-canvas"></canvas>

    <!-- START SCREEN -->
    <div id="start-screen" class="z-20 text-center space-y-4 p-6 max-w-2xl w-full flex flex-col items-center justify-center h-full">
        <h1 class="text-5xl md:text-8xl font-bold text-transparent bg-clip-text bg-gradient-to-b from-yellow-300 to-yellow-600 drop-shadow-[0_0_15px_rgba(234,179,8,0.5)] mb-2 tracking-tight">
            MASTERMIND
        </h1>
        
        <!-- High Score Badge -->
        <div class="bg-indigo-900/50 px-4 py-1 rounded-full border border-indigo-500/50 mb-2">
            <span class="text-indigo-300 text-sm mr-2">TOP SCORE:</span>
            <span id="high-score-display" class="text-yellow-400 font-bold">₹0</span>
        </div>

        <p class="text-lg md:text-xl text-indigo-200">15 Questions. 4 Lifelines. 1 Crore.</p>
        
        <!-- Name Input Section -->
        <div class="w-full max-w-xs space-y-2 mt-4">
            <label class="text-xs text-indigo-300 uppercase tracking-widest block text-left pl-2">Enter Your Name</label>
            <input type="text" id="player-name" placeholder="Naam toh suna hoga..." class="neon-input w-full bg-black/60 border-2 border-indigo-700 rounded-lg py-3 px-4 text-center text-white font-bold text-lg placeholder-gray-500 transition-all">
        </div>

        <div class="bg-black/60 p-4 rounded-xl border border-indigo-900/60 backdrop-blur-md w-full max-w-md shadow-2xl mt-4">
            <h3 class="text-yellow-400 font-bold mb-2 border-b border-indigo-800 pb-1 text-sm">RULES</h3>
            <ul class="text-left text-gray-300 space-y-1 text-sm">
                <li class="flex items-start"><i class="fas fa-check text-green-400 mt-1 mr-3 w-3"></i> <span>Answer correctly to climb.</span></li>
                <li class="flex items-start"><i class="fas fa-times text-red-400 mt-1 mr-3 w-3"></i> <span>One wrong answer ends it.</span></li>
            </ul>
        </div>

        <button onclick="startGame()" class="mt-4 pulse-gold px-10 py-4 bg-gradient-to-r from-indigo-700 to-indigo-500 rounded-full text-xl md:text-2xl font-bold tracking-widest active:scale-95 transition-transform shadow-[0_0_30px_rgba(79,70,229,0.5)] border-2 border-indigo-300/50">
            PLAY NOW
        </button>
        <p class="text-[10px] md:text-xs text-gray-500">Tap to enable audio</p>
    </div>

    <!-- GAME SCREEN -->
    <div id="game-screen" class="hidden z-10 w-full h-full max-w-7xl mx-auto flex flex-col md:flex-row p-2 md:p-4 gap-2 md:gap-4 relative">
        
        <!-- Mobile Ladder Drawer -->
        <div id="mobile-ladder" class="md:hidden fixed inset-y-0 right-0 w-64 bg-black/95 z-50 transform translate-x-full border-l border-indigo-500 flex flex-col pt-16 pb-4 px-2 shadow-2xl backdrop-blur-xl">
             <button onclick="toggleLadder()" class="absolute top-4 right-4 text-gray-400 hover:text-white p-2">
                <i class="fas fa-times text-2xl"></i>
            </button>
            <div class="text-center font-bold text-indigo-300 border-b border-indigo-800 pb-2 mb-2">PRIZE LADDER</div>
            <div id="mobile-money-ladder" class="flex-1 overflow-y-auto ladder-scroll flex flex-col-reverse p-2 gap-1"></div>
        </div>

        <!-- Main Game Area -->
        <div class="flex-1 flex flex-col justify-between h-full order-2 md:order-1 relative">
            
            <!-- Header Info -->
            <div class="flex justify-between items-center bg-black/40 p-3 rounded-xl border border-indigo-900/50 backdrop-blur-md shadow-lg">
                <div class="text-left pl-2">
                    <p class="text-[10px] text-indigo-400 uppercase tracking-widest font-semibold">Current Prize</p>
                    <p id="current-prize-display" class="text-2xl md:text-3xl font-bold text-yellow-400 drop-shadow-md">₹0</p>
                </div>
                
                <!-- Timer -->
                <div class="w-14 h-14 md:w-16 md:h-16 rounded-full border-4 border-indigo-500 flex items-center justify-center text-lg md:text-xl font-bold shadow-[0_0_15px_rgba(99,102,241,0.5)] bg-black/50" id="timer-ring">
                    <span id="timer">30</span>
                </div>

                <!-- Mobile Ladder Toggle -->
                <button onclick="toggleLadder()" class="md:hidden w-10 h-10 flex items-center justify-center bg-indigo-900/50 rounded-full border border-indigo-500 text-indigo-300 active:scale-90 transition-transform">
                    <i class="fas fa-list-ol"></i>
                </button>
            </div>

            <!-- Question Area (Centered Vertically) -->
            <div class="flex-1 flex flex-col justify-center my-2 md:my-0">
                <!-- Lifelines -->
                <div class="flex justify-center gap-3 md:gap-4 mb-4 md:mb-8">
                    <button id="lf-5050" onclick="useLifeline('5050')" class="w-14 h-14 md:w-16 md:h-16 rounded-full bg-gradient-to-b from-blue-900 to-black border border-blue-500 flex items-center justify-center active:scale-95 transition-transform shadow-lg" title="50:50">
                        <span class="text-xs md:text-sm font-bold text-blue-300">50:50</span>
                    </button>
                    <button id="lf-poll" onclick="useLifeline('poll')" class="w-14 h-14 md:w-16 md:h-16 rounded-full bg-gradient-to-b from-blue-900 to-black border border-blue-500 flex items-center justify-center active:scale-95 transition-transform shadow-lg" title="Audience Poll">
                        <i class="fas fa-users text-blue-300 text-lg"></i>
                    </button>
                    <button id="lf-ai" onclick="useLifeline('ai')" class="w-14 h-14 md:w-16 md:h-16 rounded-full bg-gradient-to-b from-purple-900 to-black border border-purple-500 flex items-center justify-center active:scale-95 transition-transform shadow-[0_0_15px_rgba(168,85,247,0.4)]" title="Ask Cyber Sage">
                        <i class="fas fa-robot text-purple-300 text-lg"></i>
                    </button>
                </div>

                <!-- Question Box -->
                <div class="relative group mb-4 md:mb-8 mx-1">
                    <div class="absolute inset-0 bg-gradient-to-r from-transparent via-indigo-600 to-transparent opacity-30 blur-lg"></div>
                    <div class="hex-btn bg-gradient-to-b from-indigo-900 to-black border-y-2 border-indigo-400 p-6 md:p-8 text-center min-h-[100px] md:min-h-[120px] flex items-center justify-center relative z-10 shadow-2xl">
                        <h2 id="question-text" class="text-lg md:text-2xl font-bold text-white leading-tight">Question loads here...</h2>
                    </div>
                </div>

                <!-- Options Grid -->
                <div class="option-container mx-1">
                    <button onclick="selectOption(0)" id="opt-0" class="hex-btn w-full py-3 md:py-4 px-4 md:px-8 bg-gradient-to-b from-slate-900 to-black border border-indigo-500/50 text-left active:border-yellow-400 flex items-center group shadow-md min-h-[60px]">
                        <span class="text-yellow-500 font-bold mr-3 md:mr-4 text-lg md:text-xl group-hover:text-black">A:</span>
                        <span class="text-base md:text-lg text-indigo-100 group-hover:text-black font-semibold option-text leading-snug">Option 1</span>
                    </button>
                    <button onclick="selectOption(1)" id="opt-1" class="hex-btn w-full py-3 md:py-4 px-4 md:px-8 bg-gradient-to-b from-slate-900 to-black border border-indigo-500/50 text-left active:border-yellow-400 flex items-center group shadow-md min-h-[60px]">
                        <span class="text-yellow-500 font-bold mr-3 md:mr-4 text-lg md:text-xl group-hover:text-black">B:</span>
                        <span class="text-base md:text-lg text-indigo-100 group-hover:text-black font-semibold option-text leading-snug">Option 2</span>
                    </button>
                    <button onclick="selectOption(2)" id="opt-2" class="hex-btn w-full py-3 md:py-4 px-4 md:px-8 bg-gradient-to-b from-slate-900 to-black border border-indigo-500/50 text-left active:border-yellow-400 flex items-center group shadow-md min-h-[60px]">
                        <span class="text-yellow-500 font-bold mr-3 md:mr-4 text-lg md:text-xl group-hover:text-black">C:</span>
                        <span class="text-base md:text-lg text-indigo-100 group-hover:text-black font-semibold option-text leading-snug">Option 3</span>
                    </button>
                    <button onclick="selectOption(3)" id="opt-3" class="hex-btn w-full py-3 md:py-4 px-4 md:px-8 bg-gradient-to-b from-slate-900 to-black border border-indigo-500/50 text-left active:border-yellow-400 flex items-center group shadow-md min-h-[60px]">
                        <span class="text-yellow-500 font-bold mr-3 md:mr-4 text-lg md:text-xl group-hover:text-black">D:</span>
                        <span class="text-base md:text-lg text-indigo-100 group-hover:text-black font-semibold option-text leading-snug">Option 4</span>
                    </button>
                </div>
            </div>
        </div>

        <!-- Sidebar Ladder (Desktop) -->
        <div class="hidden md:flex flex-col w-64 bg-black/60 border-l border-indigo-900/50 backdrop-blur-md order-1 md:order-2 h-full rounded-l-xl overflow-hidden shadow-2xl">
            <div class="p-4 bg-indigo-900/30 text-center font-bold text-indigo-300 border-b border-indigo-800 tracking-widest">
                MONEY LADDER
            </div>
            <div id="desktop-money-ladder" class="flex-1 overflow-y-auto ladder-scroll flex flex-col-reverse p-2 gap-1">
                <!-- Generated by JS -->
            </div>
        </div>
    </div>

    <!-- MODALS -->
    
    <!-- Milestone Modal -->
    <div id="milestone-modal" class="hidden fixed inset-0 bg-black/80 z-50 flex items-center justify-center backdrop-blur-sm p-4 animate-in fade-in zoom-in duration-300">
        <div class="bg-gradient-to-b from-indigo-800 to-black p-8 rounded-2xl border-4 border-yellow-500 max-w-sm w-full text-center shadow-[0_0_50px_rgba(234,179,8,0.5)] transform scale-100">
            <h2 class="text-3xl font-bold text-yellow-300 mb-2">MILESTONE!</h2>
            <div class="text-indigo-200 mb-6">Bach Gaye Guru!</div>
            <p id="milestone-amount" class="text-5xl font-bold text-white drop-shadow-md">₹10,000</p>
        </div>
    </div>

    <!-- Game Over Modal -->
    <div id="game-over-modal" class="hidden fixed inset-0 bg-black/90 z-50 flex items-center justify-center backdrop-blur-sm p-4 overflow-y-auto">
        <div class="bg-gradient-to-b from-indigo-900 to-black p-6 md:p-8 rounded-2xl border-2 border-red-500 max-w-md w-full text-center shadow-[0_0_50px_rgba(239,68,68,0.3)] my-8">
            <h2 id="end-title" class="text-3xl md:text-4xl font-bold text-white mb-2">GAME OVER</h2>
            <img id="victory-img" src="amitabh-bachchan-amitabh-bachchan-kbc.gif" class="hidden w-48 mx-auto rounded-lg mb-4 border-2 border-yellow-400 shadow-lg object-cover" alt="Victory Celebration">
            
            <p id="slang-msg" class="text-xl text-yellow-300 font-bold mb-2 italic">"Tumse na ho payega!"</p>
            <p id="end-reason" class="text-indigo-400 mb-6 text-sm">That was the wrong answer.</p>
            
            <div class="bg-black/50 p-4 rounded-lg mb-6 border border-indigo-800">
                <p class="text-xs md:text-sm text-gray-400 uppercase">You won</p>
                <p id="final-prize" class="text-3xl md:text-4xl font-bold text-yellow-400 mt-2">₹0</p>
            </div>

            <!-- Share Button -->
            <button onclick="shareScore()" class="w-full py-3 bg-green-600 active:bg-green-700 text-white font-bold rounded-lg transition text-lg shadow-lg mb-3 flex items-center justify-center gap-2">
                <i class="fab fa-whatsapp text-xl"></i> Dosto Ko Jalao
            </button>

            <button onclick="restartGame()" class="w-full py-3 bg-red-600 active:bg-red-700 text-white font-bold rounded-lg transition text-lg shadow-lg">
                TRY AGAIN
            </button>
        </div>
    </div>

    <!-- AI Lifeline Modal -->
    <div id="ai-modal" class="hidden fixed inset-0 bg-black/80 z-50 flex items-center justify-center p-4">
        <div class="bg-gray-900 w-full max-w-lg rounded-lg border border-purple-500 shadow-[0_0_30px_rgba(168,85,247,0.2)] overflow-hidden">
            <div class="bg-purple-900/50 p-3 flex justify-between items-center border-b border-purple-700">
                <div class="flex items-center gap-2">
                    <i class="fas fa-robot text-purple-300"></i>
                    <span class="font-mono text-purple-200 text-sm">CYBER_SAGE_v2.0</span>
                </div>
                <button onclick="closeModal('ai-modal')" class="text-gray-400 hover:text-white px-2 text-xl">&times;</button>
            </div>
            <div class="p-6 font-mono text-sm">
                <div class="mb-4 text-green-400 text-xs md:text-sm">
                    > Analyzing question pattern...<br>
                    > Scanning knowledge database...<br>
                    > Computing probabilities...
                </div>
                <div id="ai-response" class="text-white typing-cursor min-h-[80px] text-sm md:text-base leading-relaxed">
                    <!-- Typed by JS -->
                </div>
            </div>
            <div class="p-3 bg-gray-800 text-center">
                <button onclick="closeModal('ai-modal')" class="w-full md:w-auto px-6 py-2 bg-purple-700 active:bg-purple-600 rounded text-sm font-bold transition shadow-lg">ACKNOWLEDGE</button>
            </div>
        </div>
    </div>

    <!-- Audience Poll Modal -->
    <div id="poll-modal" class="hidden fixed inset-0 bg-black/80 z-50 flex items-center justify-center p-4">
        <div class="bg-indigo-900/95 w-full max-w-md p-6 rounded-xl border border-blue-400 shadow-[0_0_30px_rgba(59,130,246,0.3)]">
            <h3 class="text-xl md:text-2xl font-bold text-center mb-6 text-blue-200">Audience Poll Results</h3>
            <div class="flex justify-around items-end h-40 md:h-48 gap-3" id="poll-bars">
                <!-- Bars generated by JS -->
            </div>
            <button onclick="closeModal('poll-modal')" class="w-full mt-6 py-3 bg-blue-600 active:bg-blue-500 rounded font-bold shadow-lg">Close</button>
        </div>
    </div>

    <script>
        // --- GAME DATA ---
        const prizeLadder = [
            "₹1,000", "₹2,000", "₹3,000", "₹5,000", "₹10,000", // Safe Haven 1
            "₹20,000", "₹40,000", "₹80,000", "₹1,60,000", "₹3,20,000", // Safe Haven 2
            "₹6,40,000", "₹12,50,000", "₹25,00,000", "₹50,00,000", "₹1 Crore"
        ];

        // --- QUESTION POOLS (Expanded: 35 Questions per level) ---
        const easyPool = [
            { q: "Which movie's song 'Naatu Naatu' won an Oscar for Best Original Song?", o: ["Pushpa", "KGF 2", "RRR", "Baahubali 2"], a: 2 },
            { q: "What is the maximum character limit for a standard post on X (formerly Twitter) for a free user?", o: ["140", "280", "420", "500"], a: 1 },
            { q: "Who is the host of the Hindi TV reality show 'Bigg Boss'?", o: ["Amitabh Bachchan", "Karan Johar", "Salman Khan", "Shah Rukh Khan"], a: 2 },
            { q: "In the 2023 Cricket World Cup, which team did India defeat in the semi-finals?", o: ["Australia", "New Zealand", "Pakistan", "South Africa"], a: 1 },
            { q: "What does 'GPT' stand for in ChatGPT?", o: ["General Public Tool", "Generative Pre-trained Transformer", "Google Processing Tech", "Global Positioning Text"], a: 1 },
            { q: "Which Indian city is often called the 'Silicon Valley of India'?", o: ["Hyderabad", "Pune", "Bengaluru", "Chennai"], a: 2 },
            { q: "Which bird tries to rescue Sita from Ravana in the Ramayana?", o: ["Garuda", "Sampati", "Jatayu", "Kakabhushundi"], a: 2 },
            { q: "Which of these is NOT a Unified Payments Interface (UPI) app?", o: ["PhonePe", "Google Pay", "Paytm", "Candy Crush"], a: 3 },
            { q: "Who is the current CEO of Alphabet (Google)?", o: ["Satya Nadella", "Sundar Pichai", "Tim Cook", "Elon Musk"], a: 1 },
            { q: "What is the colour of the 2000 Rupee note (which was withdrawn)?", o: ["Stone Grey", "Magenta", "Bright Yellow", "Lavender"], a: 1 },
            { q: "Which Indian state is popularly known as 'God's Own Country'?", o: ["Goa", "Himachal Pradesh", "Kerala", "Uttarakhand"], a: 2 },
            { q: "What is the 'fifth taste' discovered by Japanese scientists, often described as savory?", o: ["Spicy", "Umami", "Bitter", "Sour"], a: 1 },
            { q: "Who replaced Rohit Sharma as the captain of Mumbai Indians for IPL 2024?", o: ["Suryakumar Yadav", "Hardik Pandya", "Jasprit Bumrah", "Ishan Kishan"], a: 1 },
            { q: "Which Yoga Asana is also commonly known as the 'Lotus Position'?", o: ["Shavasana", "Padmasana", "Tadasana", "Vrikshasana"], a: 1 },
            { q: "Which of these animals is the 'National Aquatic Animal' of India?", o: ["Crocodile", "Ganges River Dolphin", "Blue Whale", "Gharial"], a: 1 },
            { q: "Historically, which spice was known as 'Black Gold'?", o: ["Cardamom", "Clove", "Black Pepper", "Cumin"], a: 2 },
            { q: "In the game of Chess, which is the only piece that can jump over others?", o: ["Bishop", "Rook", "Knight", "Pawn"], a: 2 },
            { q: "The Indian National Anthem 'Jana Gana Mana' was originally composed in which language?", o: ["Hindi", "Sanskrit", "Bengali", "Marathi"], a: 2 },
            { q: "Which popular social media app features a white 'Ghost' on a yellow background as its logo?", o: ["Instagram", "Snapchat", "Pinterest", "Reddit"], a: 1 },
            { q: "In banking, what does the acronym 'KYC' stand for?", o: ["Keep Your Cash", "Know Your Customer", "Key Yield Credit", "Know Your Currency"], a: 1 },
            // New Additions (15)
            { q: "Who composed the song 'Jai Ho'?", o: ["A.R. Rahman", "Shankar Mahadevan", "Vishal-Shekhar", "Pritam"], a: 0 },
            { q: "What is the currency of Bangladesh?", o: ["Rupee", "Taka", "Yen", "Dollar"], a: 1 },
            { q: "Which is the largest mammal on Earth?", o: ["African Elephant", "Blue Whale", "Giraffe", "Hippopotamus"], a: 1 },
            { q: "The movie 'Dangal' is based on which sport?", o: ["Boxing", "Cricket", "Wrestling", "Hockey"], a: 2 },
            { q: "What is the capital of Maharashtra?", o: ["Pune", "Nagpur", "Mumbai", "Nashik"], a: 2 },
            { q: "How many players are there in a Kabaddi team on the court?", o: ["5", "6", "7", "9"], a: 2 },
            { q: "Who is affectionately known as 'Thala' in the IPL?", o: ["Virat Kohli", "Rohit Sharma", "MS Dhoni", "Suresh Raina"], a: 2 },
            { q: "What is the opposite direction of North?", o: ["East", "West", "South", "North-East"], a: 2 },
            { q: "What is the primary ingredient in an omelette?", o: ["Flour", "Milk", "Egg", "Rice"], a: 2 },
            { q: "Which festival is known as the 'Festival of Lights'?", o: ["Holi", "Eid", "Diwali", "Christmas"], a: 2 },
            { q: "The movie 'Chak De! India' revolves around which sport?", o: ["Cricket", "Football", "Hockey", "Badminton"], a: 2 },
            { q: "Who was the first woman Prime Minister of India?", o: ["Sarojini Naidu", "Indira Gandhi", "Pratibha Patil", "Sushma Swaraj"], a: 1 },
            { q: "How many zeros are there in the number one thousand?", o: ["2", "3", "4", "5"], a: 1 },
            { q: "Which fruit has its seeds on the outside?", o: ["Apple", "Mango", "Strawberry", "Guava"], a: 2 },
            { q: "The street food 'Gol Gappa' is also widely known as?", o: ["Pani Puri", "Vada Pav", "Samosa", "Jalebi"], a: 0 }
        ];

        const mediumPool = [
            { q: "The 'Aditya-L1' mission was launched to study which celestial body?", o: ["Moon", "Mars", "Sun", "Venus"], a: 2 },
            { q: "Who is the architect of the new Indian Parliament building?", o: ["Bimal Patel", "Hafeez Contractor", "Charles Correa", "Brinda Somaya"], a: 0 },
            { q: "Which gas is flushed into potato chip packets to prevent them from turning rancid?", o: ["Oxygen", "Nitrogen", "Helium", "Hydrogen"], a: 1 },
            { q: "Who was the first Indian woman to win an Olympic medal?", o: ["P.T. Usha", "Mary Kom", "Saina Nehwal", "Karnam Malleswari"], a: 3 },
            { q: "Which Indian movie was the country's official entry for the 2025 Oscars?", o: ["12th Fail", "Laapataa Ladies", "Animal", "Jawan"], a: 1 },
            { q: "The 'Statue of Unity' is located on the banks of which river?", o: ["Ganga", "Yamuna", "Tapi", "Narmada"], a: 3 },
            { q: "Who directed the movie '12th Fail'?", o: ["Rajkumar Hirani", "Vidhu Vinod Chopra", "Anurag Kashyap", "Zoya Akhtar"], a: 1 },
            { q: "Which element is the primary component of mobile phone batteries?", o: ["Cadmium", "Lead", "Lithium", "Nickel"], a: 2 },
            { q: "Who wrote the famous autobiography 'Wings of Fire'?", o: ["Jawaharlal Nehru", "A.P.J. Abdul Kalam", "Sachin Tendulkar", "M.K. Gandhi"], a: 1 },
            { q: "In which year was the 'Right to Information' (RTI) Act passed in India?", o: ["2000", "2005", "2010", "2014"], a: 1 },
            { q: "Which city was officially renamed to Prayagraj in 2018?", o: ["Varanasi", "Allahabad", "Lucknow", "Faizabad"], a: 1 },
            { q: "The 'Kada', 'Kirpan', and 'Kesh' are part of the 'Five Ks' of which religion?", o: ["Jainism", "Buddhism", "Sikhism", "Hinduism"], a: 2 },
            { q: "Who was the first Indian to win the Miss World title (not to be confused with Miss Universe)?", o: ["Aishwarya Rai", "Sushmita Sen", "Reita Faria", "Priyanka Chopra"], a: 2 },
            { q: "Which layer of the Earth's atmosphere contains the Ozone layer that protects us from UV rays?", o: ["Troposphere", "Stratosphere", "Mesosphere", "Exosphere"], a: 1 },
            { q: "The famous 'Dandi March' led by Mahatma Gandhi began in which year?", o: ["1920", "1930", "1942", "1947"], a: 1 },
            { q: "The chemical compound 'Sodium Bicarbonate' is commonly known in households as what?", o: ["Washing Soda", "Baking Soda", "Bleaching Powder", "Common Salt"], a: 1 },
            { q: "Who is the author of the Booker Prize-winning novel 'The God of Small Things'?", o: ["Jhumpa Lahiri", "Kiran Desai", "Arundhati Roy", "Chetan Bhagat"], a: 2 },
            { q: "Which Indian state shares its border with the maximum number of other states?", o: ["Madhya Pradesh", "Assam", "Uttar Pradesh", "Chhattisgarh"], a: 2 },
            { q: "The 'H1N1' virus is commonly associated with which disease?", o: ["Bird Flu", "Swine Flu", "Dengue", "Chikungunya"], a: 1 },
            { q: "In the Mahabharata, what was the name of the divine bow used by Arjuna?", o: ["Pinaka", "Gandiva", "Sharanga", "Vijaya"], a: 1 },
            // New Additions (15)
            { q: "Which team won the very first season of the IPL?", o: ["Chennai Super Kings", "Mumbai Indians", "Rajasthan Royals", "Deccan Chargers"], a: 2 },
            { q: "What is the chemical symbol for Silver?", o: ["Si", "Ag", "Au", "Pb"], a: 1 },
            { q: "Who is the author of the book 'The Discovery of India'?", o: ["Mahatma Gandhi", "Jawaharlal Nehru", "Sardar Patel", "Indira Gandhi"], a: 1 },
            { q: "What is the total number of Vedas in Hindu scripture?", o: ["3", "4", "5", "6"], a: 1 },
            { q: "Which planet in our solar system is known for its prominent rings?", o: ["Jupiter", "Saturn", "Uranus", "Neptune"], a: 1 },
            { q: "Where is the headquarters of ISRO located?", o: ["Sriharikota", "Thiruvananthapuram", "Bengaluru", "New Delhi"], a: 2 },
            { q: "Who is traditionally attributed as the author of the 'Natya Shastra'?", o: ["Kalidasa", "Bharat Muni", "Valmiki", "Vyasa"], a: 1 },
            { q: "Which is the longest bone in the human body?", o: ["Tibia", "Fibula", "Femur", "Humerus"], a: 2 },
            { q: "Which mountain pass connects Srinagar to Leh?", o: ["Rohtang Pass", "Nathu La", "Zoji La", "Shipki La"], a: 2 },
            { q: "Who wrote the national song 'Vande Mataram'?", o: ["Rabindranath Tagore", "Bankim Chandra Chatterjee", "Sarojini Naidu", "Subhash Chandra Bose"], a: 1 },
            { q: "What does USB stand for in computer terms?", o: ["Universal Serial Bus", "Unique Serial Board", "Universal System Board", "United Serial Bus"], a: 0 },
            { q: "Who is one of the co-founders of Facebook?", o: ["Bill Gates", "Jeff Bezos", "Mark Zuckerberg", "Elon Musk"], a: 2 },
            { q: "The famous Sun Temple is located in which town?", o: ["Puri", "Bhubaneswar", "Konark", "Cuttack"], a: 2 },
            { q: "Ornithology is the scientific study of what?", o: ["Insects", "Birds", "Reptiles", "Plants"], a: 1 },
            { q: "Which gas is primarily responsible for the greenhouse effect on Earth?", o: ["Oxygen", "Nitrogen", "Carbon Dioxide", "Argon"], a: 2 }
        ];

        const hardPool = [
            { q: "Who was the first person to resign from the post of Prime Minister of India?", o: ["Charan Singh", "V.P. Singh", "Morarji Desai", "H.D. Deve Gowda"], a: 2 },
            { q: "The 'Sengol' installed in the new Parliament building belongs to the traditions of which ancient dynasty?", o: ["Chola", "Pandya", "Maurya", "Gupta"], a: 0 },
            { q: "Who is the only Indian to have won an Oscar for Lifetime Achievement?", o: ["A.R. Rahman", "Gulzar", "Satyajit Ray", "Bhanu Athaiya"], a: 2 },
            { q: "Which Article of the Indian Constitution deals with the 'Uniform Civil Code'?", o: ["Article 44", "Article 370", "Article 21", "Article 51A"], a: 0 },
            { q: "What was the code name for the Indian Armed Forces operation to annex Goa in 1961?", o: ["Operation Polo", "Operation Vijay", "Operation Blue Star", "Operation Cactus"], a: 1 },
            { q: "Who designed the symbol of the Indian Rupee (₹)?", o: ["Nandalal Bose", "Udaya Kumar Dharmalingam", "Pingali Venkayya", "R.K. Laxman"], a: 1 },
            { q: "Which is the only floating national park in the world, located in India?", o: ["Kaziranga", "Sundarbans", "Keibul Lamjao", "Jim Corbett"], a: 2 },
            { q: "Who was the first Indian to be elected to the British Parliament?", o: ["Dadabhai Naoroji", "Raja Ram Mohan Roy", "Gopal Krishna Gokhale", "M.K. Gandhi"], a: 0 },
            { q: "Which is the first Indian heritage site to be inscribed on the UNESCO World Heritage List (1983)?", o: ["Taj Mahal", "Qutub Minar", "Red Fort", "Hampi"], a: 0 },
            { q: "Who was the Defense Minister of India during the 1971 Indo-Pak war?", o: ["Y.B. Chavan", "Jagjivan Ram", "Sardar Swaran Singh", "V.K. Krishna Menon"], a: 1 },
            { q: "Which is the only continent that covers all four hemispheres (North, South, East, and West)?", o: ["Asia", "Africa", "Europe", "South America"], a: 1 },
            { q: "Who served as the first Chief Election Commissioner of India?", o: ["T.N. Seshan", "Sukumar Sen", "Kalyan Sundaram", "S.P. Sen Verma"], a: 1 },
            { q: "The 'Pravasi Bharatiya Divas' is celebrated on January 9 to mark Mahatma Gandhi's return from which country?", o: ["England", "South Africa", "USA", "Japan"], a: 1 },
            { q: "Which specific isotope of Uranium is primarily used as fuel in nuclear fission reactors?", o: ["U-238", "U-235", "U-234", "U-239"], a: 1 },
            { q: "Who was the only President of India to be elected unopposed?", o: ["Dr. Rajendra Prasad", "A.P.J. Abdul Kalam", "Neelam Sanjiva Reddy", "Giani Zail Singh"], a: 2 },
            { q: "The 'Hornbill Festival', often called the 'Festival of Festivals', is celebrated in which state?", o: ["Manipur", "Mizoram", "Nagaland", "Meghalaya"], a: 2 },
            { q: "In the hierarchy of Indian civilian awards, which award ranks immediately below the Bharat Ratna?", o: ["Padma Bhushan", "Padma Shri", "Padma Vibhushan", "Gallantry Award"], a: 2 },
            { q: "Which battle in 1764 marked the decisive victory of the British East India Company over the combined forces of the Mughals and Nawabs?", o: ["Battle of Plassey", "Battle of Buxar", "Battle of Haldighati", "Battle of Panipat"], a: 1 },
            { q: "What is the scientific name of the Indian National Bird (Peacock)?", o: ["Panthera tigris", "Pavo cristatus", "Elephas maximus", "Naja naja"], a: 1 },
            { q: "Which Schedule of the Indian Constitution deals with the 'Anti-Defection Law'?", o: ["8th Schedule", "9th Schedule", "10th Schedule", "11th Schedule"], a: 2 },
            // New Additions (15)
            { q: "Who was the first Indian swimmer to cross the English Channel?", o: ["Mihir Sen", "Arati Saha", "Bula Choudhury", "Shikha Tandon"], a: 0 },
            { q: "Which Article of the Indian Constitution deals with 'Financial Emergency'?", o: ["Article 352", "Article 356", "Article 360", "Article 370"], a: 2 },
            { q: "What was the original name of the musician Tansen?", o: ["Makaranda Pandey", "Ramtanu Pandey", "Haridas", "Lal Kalavant"], a: 1 },
            { q: "Who was the first female judge appointed to the Supreme Court of India?", o: ["Sucheta Kripalani", "Leila Seth", "Fathima Beevi", "Ruma Pal"], a: 2 },
            { q: "In which year did the Jallianwala Bagh massacre take place?", o: ["1917", "1919", "1920", "1922"], a: 1 },
            { q: "Which is the only non-metal that remains liquid at room temperature?", o: ["Mercury", "Bromine", "Gallium", "Caesium"], a: 1 },
            { q: "Who gave the title 'Mahatma' to Mohandas Karamchand Gandhi?", o: ["Subhash Chandra Bose", "Rabindranath Tagore", "Gopal Krishna Gokhale", "Jawaharlal Nehru"], a: 1 },
            { q: "The concept of the 'Preamble' in the Indian Constitution was borrowed from the constitution of which country?", o: ["UK", "Canada", "USA", "France"], a: 2 },
            { q: "Which Chola king built the Brihadeeswarar Temple at Thanjavur?", o: ["Rajendra Chola I", "Raja Raja Chola I", "Karikala Chola", "Vijayalaya Chola"], a: 1 },
            { q: "Who was the first Governor-General of independent India?", o: ["C. Rajagopalachari", "Lord Mountbatten", "Lord Wavell", "Dr. Rajendra Prasad"], a: 1 },
            { q: "Who is the author of the fictional town 'Malgudi' in his stories?", o: ["Ruskin Bond", "R.K. Narayan", "Mulk Raj Anand", "Vikram Seth"], a: 1 },
            { q: "Which village in Karnataka is known for having Sanskrit as its primary spoken language?", o: ["Mattur", "Hampi", "Gokarna", "Melukote"], a: 0 },
            { q: "The motto 'Satyameva Jayate' is taken from which ancient text?", o: ["Rig Veda", "Mundaka Upanishad", "Bhagavad Gita", "Mahabharata"], a: 1 },
            { q: "Who designed the Old Parliament House in New Delhi?", o: ["Le Corbusier", "Edwin Lutyens & Herbert Baker", "Charles Correa", "Bimal Patel"], a: 1 },
            { q: "What is the approximate value of Avogadro's constant?", o: ["6.022 x 10^23", "3.14159", "9.8 m/s^2", "1.6 x 10^-19"], a: 0 }
        ];

        // Active questions for the current game
        let questions = [];
        let playerName = "Player";
        let bestScore = 0;

        function getRandomQuestions(pool, count) {
            const shuffled = [...pool].sort(() => 0.5 - Math.random());
            return shuffled.slice(0, count);
        }

        function generateGameQuestions() {
            questions = [
                ...getRandomQuestions(easyPool, 5),
                ...getRandomQuestions(mediumPool, 5),
                ...getRandomQuestions(hardPool, 5)
            ];
        }

        // --- AUDIO ENGINE ---
        const AudioContext = window.AudioContext || window.webkitAudioContext;
        let audioCtx;
        
        const soundEngine = {
            init: () => {
                if (!audioCtx) audioCtx = new AudioContext();
                if (audioCtx.state === 'suspended') audioCtx.resume();
            },
            playTone: (freq, type, duration, vol = 0.1) => {
                const osc = audioCtx.createOscillator();
                const gain = audioCtx.createGain();
                osc.type = type;
                osc.frequency.setValueAtTime(freq, audioCtx.currentTime);
                gain.gain.setValueAtTime(vol, audioCtx.currentTime);
                gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + duration);
                osc.connect(gain);
                gain.connect(audioCtx.destination);
                osc.start();
                osc.stop(audioCtx.currentTime + duration);
            },
            playClick: () => soundEngine.playTone(800, 'sine', 0.1, 0.05),
            playLock: () => {
                const osc1 = audioCtx.createOscillator();
                const osc2 = audioCtx.createOscillator();
                const gain = audioCtx.createGain();
                osc1.frequency.setValueAtTime(100, audioCtx.currentTime);
                osc2.frequency.setValueAtTime(103, audioCtx.currentTime);
                gain.gain.setValueAtTime(0.1, audioCtx.currentTime);
                gain.gain.linearRampToValueAtTime(0, audioCtx.currentTime + 2);
                osc1.connect(gain);
                osc2.connect(gain);
                gain.connect(audioCtx.destination);
                osc1.start(); osc2.start();
                osc1.stop(audioCtx.currentTime + 2); osc2.stop(audioCtx.currentTime + 2);
            },
            playCorrect: () => {
                soundEngine.playTone(440, 'triangle', 0.5, 0.1);
                setTimeout(() => soundEngine.playTone(554, 'triangle', 0.5, 0.1), 100);
                setTimeout(() => soundEngine.playTone(659, 'triangle', 0.8, 0.1), 200);
            },
            playWrong: () => {
                soundEngine.playTone(150, 'sawtooth', 0.8, 0.2);
                setTimeout(() => soundEngine.playTone(130, 'sawtooth', 0.8, 0.2), 200);
            },
            playLifeline: () => {
                soundEngine.playTone(1200, 'sine', 0.2, 0.1);
                setTimeout(() => soundEngine.playTone(2000, 'sine', 0.4, 0.1), 100);
            },
            playMilestone: () => {
                // Fanfare
                soundEngine.playTone(523, 'square', 0.2); // C5
                setTimeout(() => soundEngine.playTone(659, 'square', 0.2), 150); // E5
                setTimeout(() => soundEngine.playTone(783, 'square', 0.4), 300); // G5
                setTimeout(() => soundEngine.playTone(1046, 'square', 0.6), 500); // C6
            }
        };

        // --- CONFETTI ENGINE ---
        const confettiCanvas = document.getElementById('confetti-canvas');
        const ctx = confettiCanvas.getContext('2d');
        let confettiParticles = [];
        let confettiAnimationId = null;

        function resizeCanvas() {
            confettiCanvas.width = window.innerWidth;
            confettiCanvas.height = window.innerHeight;
        }
        window.addEventListener('resize', resizeCanvas);
        resizeCanvas();

        function createConfetti(isMassive = false) {
            const count = isMassive ? 300 : 100;
            const colors = ['#f00', '#0f0', '#00f', '#ff0', '#0ff', '#f0f', '#fff', '#ffa500'];
            
            for (let i = 0; i < count; i++) {
                confettiParticles.push({
                    x: Math.random() * confettiCanvas.width,
                    y: isMassive ? Math.random() * confettiCanvas.height - confettiCanvas.height : -10,
                    w: Math.random() * 10 + 5,
                    h: Math.random() * 10 + 5,
                    color: colors[Math.floor(Math.random() * colors.length)],
                    vy: Math.random() * 5 + 2,
                    vx: Math.random() * 4 - 2,
                    spin: Math.random() * 0.2 - 0.1
                });
            }
        }

        function updateConfetti() {
            ctx.clearRect(0, 0, confettiCanvas.width, confettiCanvas.height);
            
            confettiParticles.forEach((p, i) => {
                p.y += p.vy;
                p.x += p.vx;
                p.vx += p.spin;
                
                ctx.fillStyle = p.color;
                ctx.fillRect(p.x, p.y, p.w, p.h);
                
                if (p.y > confettiCanvas.height) {
                    confettiParticles.splice(i, 1);
                }
            });

            if (confettiParticles.length > 0) {
                confettiAnimationId = requestAnimationFrame(updateConfetti);
            } else {
                cancelAnimationFrame(confettiAnimationId);
            }
        }

        function fireConfetti(duration = 2000, isMassive = false) {
            if(confettiAnimationId) cancelAnimationFrame(confettiAnimationId);
            confettiParticles = [];
            createConfetti(isMassive);
            updateConfetti();
            
            if(isMassive) {
                // Keep adding particles for a while
                let interval = setInterval(() => createConfetti(false), 200);
                setTimeout(() => clearInterval(interval), duration);
            }
        }

        // --- GAME LOGIC ---
        let currentLevel = 0;
        let isGameActive = false;
        let canAnswer = false;
        let timerInterval;
        let timeLeft = 30;
        let lifelines = { '5050': true, 'poll': true, 'ai': true };
        let isLadderOpen = false;
        
        // High Score Init
        window.onload = function() {
            const savedScore = localStorage.getItem('kbcHighScore');
            if(savedScore) {
                bestScore = parseInt(savedScore);
                document.getElementById('high-score-display').innerText = formatCurrency(bestScore);
            }
        };

        function formatCurrency(val) {
            if (val >= 10000000) return "₹" + (val/10000000) + " Crore";
            if (val >= 100000) return "₹" + (val/100000) + " Lakh";
            return "₹" + val.toLocaleString('en-IN');
        }

        function startGame() {
            const nameInput = document.getElementById('player-name').value.trim();
            if(!nameInput) {
                alert("Naam toh batao! (Enter your name)");
                return;
            }
            playerName = nameInput;

            soundEngine.init();
            soundEngine.playClick();
            generateGameQuestions();
            
            document.getElementById('start-screen').classList.add('hidden');
            document.getElementById('game-screen').classList.remove('hidden');
            document.getElementById('game-screen').classList.add('flex');
            document.getElementById('game-over-modal').classList.add('hidden');
            document.getElementById('milestone-modal').classList.add('hidden');
            
            // Hide victory image on start
            document.getElementById('victory-img').classList.add('hidden');

            currentLevel = 0;
            lifelines = { '5050': true, 'poll': true, 'ai': true };
            
            document.querySelectorAll('.lifeline-used').forEach(el => el.classList.remove('lifeline-used'));
            buildLadder('desktop-money-ladder');
            buildLadder('mobile-money-ladder');
            loadQuestion();
        }

        function toggleLadder() {
            const ladder = document.getElementById('mobile-ladder');
            isLadderOpen = !isLadderOpen;
            if(isLadderOpen) ladder.classList.add('ladder-open');
            else ladder.classList.remove('ladder-open');
            soundEngine.playClick();
        }

        function buildLadder(elementId) {
            const container = document.getElementById(elementId);
            container.innerHTML = '';
            prizeLadder.forEach((prize, index) => {
                const div = document.createElement('div');
                div.className = `p-2 rounded flex justify-between text-xs md:text-sm ${index % 5 === 4 ? 'text-white font-bold' : 'text-orange-300'}`;
                div.id = `${elementId}-${index}`;
                div.innerHTML = `<span>${index + 1}</span> <span>${prize}</span>`;
                container.appendChild(div);
            });
        }

        function updateLadder() {
            const ids = ['desktop-money-ladder', 'mobile-money-ladder'];
            ids.forEach(baseId => {
                for(let i=0; i<prizeLadder.length; i++) {
                    const el = document.getElementById(`${baseId}-${i}`);
                    if(el) {
                        el.classList.remove('bg-orange-500', 'text-black');
                        el.classList.add(i % 5 === 4 ? 'text-white' : 'text-orange-300');
                    }
                }
                const currentEl = document.getElementById(`${baseId}-${currentLevel}`);
                if(currentEl) {
                    currentEl.classList.remove('text-orange-300', 'text-white');
                    currentEl.classList.add('bg-orange-500', 'text-black', 'font-bold');
                    currentEl.scrollIntoView({ behavior: 'smooth', block: 'center' });
                }
            });
            document.getElementById('current-prize-display').innerText = currentLevel > 0 ? prizeLadder[currentLevel - 1] : "₹0";
        }

        function loadQuestion() {
            isGameActive = true;
            canAnswer = true;
            updateLadder();
            
            const qData = questions[currentLevel];
            document.getElementById('question-text').innerText = qData.q;
            
            // STRONG FIX FOR STICKY MOBILE HOVER: REPLACE BUTTONS
            for(let i=0; i<4; i++) {
                const oldBtn = document.getElementById(`opt-${i}`);
                const newBtn = oldBtn.cloneNode(true);
                oldBtn.parentNode.replaceChild(newBtn, oldBtn);
                
                // Reset styling classes completely
                newBtn.className = "hex-btn w-full py-3 md:py-4 px-4 md:px-8 bg-gradient-to-b from-slate-900 to-black border border-indigo-500/50 text-left active:border-yellow-400 flex items-center group shadow-md min-h-[60px]";
                newBtn.disabled = false;
                
                // Restore text content
                newBtn.querySelector('.option-text').innerText = qData.o[i];
                newBtn.querySelector('span:first-child').innerText = String.fromCharCode(65 + i) + ":";
                
                // Re-attach listener
                newBtn.onclick = () => selectOption(i);
            }

            // Timer
            clearInterval(timerInterval);
            timeLeft = currentLevel < 5 ? 30 : currentLevel < 10 ? 60 : 0;
            
            const timerEl = document.getElementById('timer');
            if (timeLeft > 0) {
                timerEl.innerText = timeLeft;
                timerInterval = setInterval(() => {
                    timeLeft--;
                    timerEl.innerText = timeLeft;
                    if(timeLeft <= 0) {
                        clearInterval(timerInterval);
                        gameOver("Time's Up!");
                    }
                }, 1000);
            } else {
                timerEl.innerText = "∞";
            }
        }

        function selectOption(index) {
            if (!canAnswer) return;
            canAnswer = false;
            clearInterval(timerInterval);
            soundEngine.playLock();

            const selectedBtn = document.getElementById(`opt-${index}`);
            selectedBtn.classList.add('locked-answer');

            setTimeout(() => {
                checkAnswer(index);
            }, 2000);
        }

        function checkAnswer(selectedIndex) {
            const correctIndex = questions[currentLevel].a;
            const selectedBtn = document.getElementById(`opt-${selectedIndex}`);
            const correctBtn = document.getElementById(`opt-${correctIndex}`);

            selectedBtn.classList.remove('locked-answer');

            if (selectedIndex === correctIndex) {
                // CORRECT
                selectedBtn.classList.add('correct-answer');
                soundEngine.playCorrect();
                
                setTimeout(() => {
                    // MILESTONE CHECK
                    if (currentLevel === 4) { // Level 5 (10,000)
                        triggerMilestone("₹10,000");
                        currentLevel++;
                    } else if (currentLevel === 9) { // Level 10 (3,20,000)
                        triggerMilestone("₹3,20,000");
                        currentLevel++;
                    } else {
                        currentLevel++;
                        if (currentLevel >= questions.length) {
                            gameWon();
                        } else {
                            loadQuestion();
                        }
                    }
                }, 2000);
            } else {
                // WRONG
                selectedBtn.classList.add('wrong-answer');
                correctBtn.classList.add('correct-answer');
                soundEngine.playWrong();
                setTimeout(() => {
                    gameOver("Wrong Answer");
                }, 2000);
            }
        }

        function triggerMilestone(amount) {
            const modal = document.getElementById('milestone-modal');
            const amountEl = document.getElementById('milestone-amount');
            amountEl.innerText = amount;
            modal.classList.remove('hidden');
            soundEngine.playMilestone();
            fireConfetti(2000, true);

            setTimeout(() => {
                modal.classList.add('hidden');
                if (currentLevel >= questions.length) {
                    gameWon();
                } else {
                    loadQuestion();
                }
            }, 3000);
        }

        // --- LIFELINES (Standard Logic) ---
        function useLifeline(type) {
            if (!isGameActive || !canAnswer || !lifelines[type]) return;
            soundEngine.playLifeline();
            lifelines[type] = false;
            document.getElementById(`lf-${type}`).classList.add('lifeline-used');
            const correctIdx = questions[currentLevel].a;

            if (type === '5050') {
                let wrongIndices = [0, 1, 2, 3].filter(i => i !== correctIdx);
                wrongIndices.sort(() => Math.random() - 0.5);
                wrongIndices.slice(0, 2).forEach(idx => {
                    const btn = document.getElementById(`opt-${idx}`);
                    btn.querySelector('.option-text').innerText = "";
                    btn.classList.add('opacity-0', 'pointer-events-none');
                });
            } else if (type === 'poll') {
                showPollModal(correctIdx);
            } else if (type === 'ai') {
                showAiModal(correctIdx);
            }
        }

        function showPollModal(correctIdx) {
            const modal = document.getElementById('poll-modal');
            const container = document.getElementById('poll-bars');
            container.innerHTML = '';
            modal.classList.remove('hidden');
            let percentages = [0,0,0,0];
            percentages[correctIdx] = 40 + Math.floor(Math.random() * 30);
            let remaining = 100 - percentages[correctIdx];
            for(let i=0; i<4; i++) {
                if(i !== correctIdx) {
                    let val = Math.floor(Math.random() * (remaining / 2));
                    percentages[i] = val;
                    remaining -= val;
                }
            }
            let randomWrong = [0,1,2,3].filter(i => i!==correctIdx)[0];
            percentages[randomWrong] += remaining;
            ['A','B','C','D'].forEach((label, i) => {
                const height = percentages[i];
                const bar = document.createElement('div');
                bar.className = 'flex flex-col items-center justify-end h-full w-10 md:w-12';
                bar.innerHTML = `<div class="text-white font-bold mb-1 text-xs md:text-base">${percentages[i]}%</div><div class="w-full bg-blue-500 rounded-t transition-all duration-1000" style="height: 0%"></div><div class="text-blue-300 font-bold mt-2 text-xs md:text-base">${label}</div>`;
                container.appendChild(bar);
                setTimeout(() => { bar.children[1].style.height = `${height}%`; }, 100);
            });
        }

        function showAiModal(correctIdx) {
            const modal = document.getElementById('ai-modal');
            const textBox = document.getElementById('ai-response');
            modal.classList.remove('hidden');
            textBox.innerHTML = '';
            const options = ["Option A", "Option B", "Option C", "Option D"];
            const text = `I am ${90 + Math.floor(Math.random() * 9)}% confident the answer is ${options[correctIdx]}.`;
            let i = 0;
            const typeInterval = setInterval(() => {
                textBox.innerText += text.charAt(i);
                i++;
                if(i >= text.length) clearInterval(typeInterval);
            }, 30);
        }

        function closeModal(id) { document.getElementById(id).classList.add('hidden'); }

        // --- SLANG GENERATOR ---
        function getSlangMessage(amountValue, isWin) {
            if(isWin) return `7 Crore! ${playerName}, tu toh Devmanus nikla!`;

            if(amountValue === 0) return `Arre ${playerName} bhai, kya gunda banega re tu?`;
            if(amountValue <= 5000) return `Tumse na ho payega, ${playerName}!`;
            if(amountValue <= 80000) return `Thoda aur padhai karta ${playerName}, toh scene alag hota.`;
            if(amountValue <= 320000) return `Sahi khel gaya ${playerName}! Not bad!`;
            if(amountValue <= 5000000) return `Kadak ${playerName} bhai! Paisa hi paisa hoga!`;
            
            return `Well played ${playerName}!`;
        }

        function parseAmount(amtStr) {
            if(amtStr === "₹1 Crore") return 10000000;
            return parseInt(amtStr.replace(/[₹,]/g, ''));
        }

        // --- GAME END ---
        function gameOver(reason) {
            isGameActive = false;
            const modal = document.getElementById('game-over-modal');
            
            // Hide victory image on loss
            document.getElementById('victory-img').classList.add('hidden');

            document.getElementById('end-title').innerText = "KHELA KHATAM";
            document.getElementById('end-title').className = "text-3xl md:text-4xl font-bold text-white mb-2";
            document.getElementById('end-reason').innerText = reason;
            
            let winAmount = "₹0";
            if (currentLevel >= 10) winAmount = "₹3,20,000";
            else if (currentLevel >= 5) winAmount = "₹10,000";
            document.getElementById('final-prize').innerText = winAmount;

            // Update High Score logic
            const currentVal = parseAmount(winAmount);
            if(currentVal > bestScore) {
                bestScore = currentVal;
                localStorage.setItem('kbcHighScore', bestScore);
                document.getElementById('high-score-display').innerText = winAmount;
            }

            // Set slang
            document.getElementById('slang-msg').innerText = getSlangMessage(currentVal, false);

            modal.classList.remove('hidden');
        }

        function gameWon() {
            isGameActive = false;
            const modal = document.getElementById('game-over-modal');
            
            // Show victory image
            document.getElementById('victory-img').classList.remove('hidden');
            
            document.getElementById('end-title').innerText = "ADBHUT!";
            document.getElementById('end-title').className = "text-5xl md:text-6xl font-bold text-transparent bg-clip-text bg-gradient-to-b from-yellow-300 to-yellow-600 mb-2";
            document.getElementById('end-reason').innerText = "Saare sawaal sahi!";
            document.getElementById('final-prize').innerText = "₹1 Crore";
            
            // Update High Score
            const currentVal = 10000000;
            if(currentVal > bestScore) {
                bestScore = currentVal;
                localStorage.setItem('kbcHighScore', bestScore);
                document.getElementById('high-score-display').innerText = "₹1 Crore";
            }

            // Set slang
            document.getElementById('slang-msg').innerText = getSlangMessage(currentVal, true);

            modal.classList.remove('hidden');
            soundEngine.playMilestone();
            fireConfetti(5000, true);
        }

        function restartGame() { 
            // Reset to start screen to ask for name again or just start? 
            // Let's just restart keeping the name
            startGame(); 
        }

        // --- SOCIAL SHARE ---
        async function shareScore() {
            const prize = document.getElementById('final-prize').innerText;
            const text = `🔥 Maine Mastermind KBC mein ${prize} jeeta! \n\n${playerName}: "${document.getElementById('slang-msg').innerText}"\n\nHai dum toh beat kar ke dikha! 💪😎`;
            
            if (navigator.share) {
                try {
                    await navigator.share({
                        title: 'Mastermind Quiz Score',
                        text: text,
                        url: window.location.href
                    });
                } catch (err) {
                    console.log('Share failed:', err);
                }
            } else {
                // Fallback for desktop
                try {
                    await navigator.clipboard.writeText(text);
                    alert("Score copied to clipboard! Paste it in WhatsApp.");
                } catch (err) {
                    alert("Sharing not supported on this device.");
                }
            }
        }

    </script>
</body>
</html>
